<script type="text/worker">
	// Primary Stats
	var primaryStats = [ "stats_courage", "stats_intelligence", "stats_charisme", "stats_adresse", "stats_force", "stats_attaque", "stats_parade"];
	// Secondary Stats
	var secondaryStats = [	"stats_charisme_total", "stats_intelligence_total", "stats_adresse_total", "stats_force_total", "stats_courage_total",
							"stats_magiepsy_mod", "stats_magiephy_mod", "stats_resimagie_mod", "stats_fouille_mod", "stats_jet_mod" ];
	var prStats = {
		change: [ "repeating_armures:armure_prphy", "repeating_armures:armure_prmag", "prnat" ],
		remove: [ "repeating_armures" ]
	};
	// items weight
	var weightStats = [	"richesse_berylium", "richesse_thritil", "poids_bourses",
						"poids_materiels", "poids_butins", "poids_livres", "poids_bouffes", "personnage_charge_max", "poids_sacs_max"  ];
	// repeating items sections
	var weightSections = {
		change: [ "repeating_materiels:materiel_poids", "repeating_butins:butin_poids", "repeating_bouffes:bouffe_poids", "repeating_livres" ],
		remove: [ "repeating_materiels", "repeating_butins", "repeating_bouffes", "repeating_livres" ]
	};
	// max available weight
	var weightStats_max = {
		change: [ "repeating_sacs:sac_charge_max", "repeating_bourses:bourse_charge_max" ],
		remove: [ "repeating_sacs", "repeating_bourses" ]
	}

	var levelAndXP = [ 	0, 100, 300, 600, 1000, 1500, 2100, 2800, 3600, 4500,
						5500, 6600, 7800, 9100, 10500, 12000, 13600, 15300, 17100, 19000,
						21000, 24000, 29000, 35000, 45000, 60000 ];

	/*---------
		EVENTS
	----------*/
	// Primary Stats
	on( primaryStats.map( stat => `change:${stat} change:${stat}_mod` ).join(" "), function(e) {
		updatePrimaryStat( e.sourceAttribute.replace( "_mod", "" ) );
	});
	// Secondary Stats & Secondary Mods
	on( secondaryStats.map( stat => `change:${stat}` ).join(" "), function() {
		updateSecondaryStats();
	});
	// PR Physique et magique
	on( prStats[ "change" ].map( stat => `change:${stat}` ).join(" ") + " " + prStats[ "remove" ].map( stat => `remove:${stat}` ).join(" "), function() {
		updatePR();
	});
	// Déplacement
	on("change:prphy change:stats_force_total", function() {
		updateDeplacement();
	});
	// Equive
	on("change:stats_adresse_total change:prphy change:stats_esquive_mod change:personnage_surcharge", function() {
		updateEsquive();
	});
	// Level
	on("change:personnage_niveau", function() {
		updateXP();
	});
	// Total golds
	on("change:richesse_or change:richesse_argent change:richesse_cuivre", function() {
		updatePO();
	});
	// total repeating section weight
	on( weightSections[ "change" ].map( stat => `change:${stat}` ).join(" ") + " " + weightSections[ "remove" ].map( stat => `remove:${stat}` ).join(" "), function( e ) {
		var section = e[ 'sourceAttribute' ].split('-')[0];

		if( section === "repeating_materiels_" ) {
			updateRSSum( "repeating_materiels", "materiel_poids", "poids_materiels" );
		} else if( section === "repeating_butins_" ) {
			updateRSSum( "repeating_butins", "butin_poids", "poids_butins" );
		} else if( section === "repeating_bouffes_" ) {
			updateRSSum( "repeating_bouffes", "bouffe_poids", "poids_bouffes" );
		} else if( section === "repeating_livres_" ) {
			updateLivresCharge();
		}
	});
	// total weight
	on( weightStats.map( stat => `change:${stat}` ).join(" "), function() {
		updateCharge();
	});
	// max available weight
	on( weightStats_max[ "change" ].map( stat => `change:${stat}` ).join(" ") + " " + weightStats_max[ "remove" ].map( stat => `remove:${stat}` ).join(" "), function( e ) {
		var section = e[ 'sourceAttribute' ].split('-')[0];

		if( section === "repeating_sacs_" ) {
			updateRSSum( "repeating_sacs", "sac_charge_max", "poids_sacs_max" );
		} else if( section === "repeating_bourses_" ) {
			updateRSSum( "repeating_bourses", "bourse_charge_max", "poids_bourses_max" );
		}
	});
	// change magic school tab
	on("change:repeating_ecolesmagie:ecolemagie_selected change:ecolemagie_selectall", function( e ) {
		if( e[ "sourceType"] === "player" ) {
			updateMagicSchoolTab( e );
		}
	});
	// change magic Filter
	on("change:tab_ecolemagie change:tab_niveaumagie", function() {
		displayMagicSpells();
	});
	// export
	on("change:export_start", function() {
		start_export();
	});
	on("change:import_start", function( e ) {
		start_import();
	});
	on("change:tab_reglages sheet:opened", function( e ) {
		reset_export();
	});

	/*------------
		FUNCTIONS
	-------------*/
	function safeInt( val ) { return parseInt( val, 10 ) || 0;	}

	function structSafeInt( v ) {
		for( attr in v ) {
			v[ attr ] = safeInt( v[ attr ] );
		}
		return v;
	}

	function safeFloat( val ) { return parseFloat( val ) || 0;	}

	function structSafeFloat( v ) {
		for( attr in v ) {
			v[ attr ] = safeFloat( v[ attr ] );
		}
		return v;
	}

	function updatePrimaryStat( attr ) {
		getAttrs( [ attr, `${attr}_mod` ], function( v ) {
			setAttrs({
				[ `${attr}_total` ]: safeInt( v[ attr ] ) + safeInt( v[ attr + "_mod" ] )
			});
		});
	}

	function updateSecondaryStats() {
		getAttrs( secondaryStats, function( sValues ) {
			var v = structSafeInt( sValues );
			var magiePsy = Math.ceil( ( v[ "stats_intelligence_total"] + v[ "stats_charisme_total" ] ) / 2 );
			var magiePhy = Math.ceil( ( v[ "stats_intelligence_total"] + v[ "stats_adresse_total" ] ) / 2 );
			var resiMagie = Math.ceil( ( v[ "stats_intelligence_total"] + v[ "stats_courage_total" ] + v[ "stats_force_total" ] ) / 3 );

			var bonusIntel = " ";
			var bonusDegatsIntel = 0;
			var bonusAdresse = " ";
			var bonusForce = " ";
			var bonusDegatsForce = 0;

			if( v[ "stats_intelligence_total" ] > 12 ) {
				bonusIntel = "Pour chaque point d'Intelligence supérieur à 12 : +1 point de dégâts des sorts (selon sortilège).";
				bonusDegatsIntel = v[ "stats_intelligence_total" ] - 12;
			}

			if( v[ "stats_adresse_total" ] > 12 ) {
				bonusAdresse = "Adresse supérieure à 12 : +1 à l'Attaque OU à la Parade (un seul point quel que soit le score).";
			} else if( v[ "stats_adresse_total" ] <= 8 ) {
				bonusAdresse = "Adresse à 8 ou inférieur : -1 à l'Attaque OU à la Parade.";
			}

			if( v[ "stats_force_total" ] > 12 ) {
				bonusForce = "Pour chaque point de Force supérieur à 12 : +1 Point d'Impact.";
				bonusDegatsForce = v[ "stats_force_total" ] - 12;
			} else if( v[ "stats_force_total" ] <= 8 ) {
				bonusForce = "Force de 8 ou inférieure : -1 Point d'Impact.";
				bonusDegatsForce = -1;
			}

			setAttrs({
				"stats_magiepsy": magiePsy,
				"stats_magiepsy_total": magiePsy + v[ "stats_magiepsy_mod" ],
				"stats_magiephy": magiePhy,
				"stats_magiephy_total": magiePhy + v[ "stats_magiephy_mod" ],
				"stats_resimagie": resiMagie,
				"stats_resimagie_total": resiMagie + v[ "stats_resimagie_mod" ],
				"stats_fouille": v[ "stats_intelligence_total"],
				"stats_fouille_total": v[ "stats_intelligence_total"] + v[ "stats_fouille_mod" ],
				"bonusintel": bonusIntel,
				"bonusdegatsintel": bonusDegatsIntel,
				"stats_jet": v[ "stats_adresse_total" ],
				"stats_jet_total": v[ "stats_adresse_total" ] + v[ "stats_jet_mod" ],
				"bonusadresse": bonusAdresse,
				"bonusforce": bonusForce,
				"bonusdegatsforce": bonusDegatsForce
			});
		});
	}

	function updateDeplacement() {
		getAttrs( [ "stats_force_total", "deplacementrapide", "deplacementrapide_duree", "deplacementsprint", "deplacementsprint_duree", "prphy" ], function( sValues ) {
			var v = structSafeInt( sValues );
			var prPhy = v[ "prphy" ];
			var deplacementRapide = v[ "deplacementrapide" ];
			var deplacementRapideDuree = v[ "deplacementrapide_duree" ];
			var deplacementSprint = v[ "deplacementsprint" ];
			var deplacementSprintDuree = v[ "deplacementsprint_duree" ];

			// PR vs Déplacement
			if( prPhy === 0 || prPhy === 1 ) {
				deplacementRapide = 8;
				deplacementRapideDuree = v[ "stats_force_total" ] * 20;
				deplacementSprint = 12;
				deplacementSprintDuree = v[ "stats_force_total" ] * 5;
			} else if( prPhy === 2 ) {
				deplacementRapide = 6;
				deplacementRapideDuree = v[ "stats_force_total" ] * 18;
				deplacementSprint = 10;
				deplacementSprintDuree = v[ "stats_force_total" ] * 4;
			} else if( prPhy === 3 || prPhy === 4 ) {
				deplacementRapide = 4;
				deplacementRapideDuree = v[ "stats_force_total" ] * 15;
				deplacementSprint = 8;
				deplacementSprintDuree = v[ "stats_force_total" ] * 4;
			} else if( prPhy === 5 ) {
				deplacementRapide = 4;
				deplacementRapideDuree = v[ "stats_force_total" ] * 10;
				deplacementSprint = 6;
				deplacementSprintDuree = v[ "stats_force_total" ] * 3;
			} else if( prPhy === 6 ) {
				deplacementRapide = 3;
				deplacementRapideDuree = v[ "stats_force_total" ] * 8;
				deplacementSprint = 4;
				deplacementSprintDuree = v[ "stats_force_total" ] * 3;
			} else if( prPhy === 7 ) {
				deplacementRapide = 2;
				deplacementRapideDuree = v[ "stats_force_total" ] * 7;
				deplacementSprint = 3;
				deplacementSprintDuree = v[ "stats_force_total" ] * 2;
			} else if( prPhy > 7 ) {
				deplacementRapide = 1;
				deplacementRapideDuree = v[ "stats_force_total" ] * 5;
				deplacementSprint = 2;
				deplacementSprintDuree = v[ "stats_force_total" ] * 2;
			}

			setAttrs({
				"deplacementrapide": deplacementRapide,
				"deplacementrapide_duree": deplacementRapideDuree,
				"deplacementsprint": deplacementSprint,
				"deplacementsprint_duree": deplacementSprintDuree
			}, { silent: true });
		});
	}

	function updateEsquive() {
		getAttrs( [ "stats_adresse_total", "stats_esquive_mod", "prphy", "personnage_surcharge" ], function( sValues ) {
			var v = structSafeInt( sValues );
			var esquive = v[ "stats_adresse_total" ];
			var prPhy = v[ "prphy" ];
			var surcharge = v[ "personnage_surcharge" ];

			// PR vs Esquive
			if( prPhy === 0 || prPhy === 1 ) {
				esquive += 1;
			} else if( prPhy === 3 || prPhy === 4 ) {
				esquive += - 2;
			} else if( prPhy === 5 ) {
				esquive += -4;
			} else if( prPhy === 6 ) {
				esquive += - 5;
			} else if( prPhy === 7 ) {
				esquive += - 6;
			} else if( prPhy > 7 ) {
				esquive = 0;
			}

			// surcharge vs Esquive
			if( surcharge === 4  ) {
				esquive += -2;
			} else if( surcharge === 5 ) {
				esquive = 0;
			}

			setAttrs({
				"stats_esquive": esquive,
				"stats_esquive_total": esquive + v[ "stats_esquive_mod" ]
			}, { silent: true });
		});
	}

	function updateXP() {
		getAttrs( [ "personnage_niveau" ], function( v ) {
			var level = safeInt( v[ "personnage_niveau" ] );

			setAttrs({
				"personnage_xp_max": safeInt( levelAndXP[ level ], { silent : true} )
			});
		});
	}

	function updatePR() {
		var prPhy = 0;
		var prMag = 0;
		getSectionIDs( "repeating_armures", function(idarray) {
			getAttrs( [ "prnat", ...idarray.map(id => `repeating_armures_${id}_armure_prphy`), ...idarray.map(id => `repeating_armures_${id}_armure_prmag`) ], function( sValues ) {
				var v = structSafeInt( sValues );

				for( var i in idarray) {
					prPhy += v[`repeating_armures_${idarray[i]}_armure_prphy`];
					prMag += v[`repeating_armures_${idarray[i]}_armure_prmag`];
				}

				setAttrs({
					"prphy": prPhy,
					"prmag": prMag,
					"pr": prPhy + prMag + v[ "prnat" ]
				});
			});
		});
	}

	function updatePO() {
		getAttrs( ["richesse_or","richesse_argent","richesse_cuivre"], function( sValues ) {
			var v = structSafeInt( sValues );
			setAttrs({
				"poids_bourses": v[ "richesse_or" ] + v[ "richesse_argent" ] + v[ "richesse_cuivre" ]
			});
		});
	}

	function updateCharge() {
		getAttrs( weightStats, function( sValues ) {
			var v = structSafeFloat( sValues );
			var boursesCharge = Math.floor( v[ "poids_bourses" ] * 0.1 ) * 0.1;
			var lingotsCharge = ( Math.floor( v[ "richesse_berylium" ] * 5 ) * 0.1 ) + ( Math.floor( v[ "richesse_thritil" ] * 3 ) * 0.1 );

			var livresCharge = v[ "poids_livres" ] * 0.5;
			var matosCharge = v[ "poids_materiels" ] + v[ "poids_butins" ] + v[ "poids_bouffes" ];
			var sacsCharge = ( boursesCharge + lingotsCharge + matosCharge + livresCharge ).toFixed( 1 );

			// Charge vs Encombrement
			var charCharge_max = v["personnage_charge_max" ];
			var sacsCharge_max= v[ "poids_sacs_max" ];
			var percentCharge = Math.floor( sacsCharge * 100 / sacsCharge_max );
			var surcharge = 0;

			if( sacsCharge >= charCharge_max ) {
				surcharge = 5; // Equipement très encombrant
			} else if( percentCharge >= 90 ) {
				surcharge = 4; // Sacs plein
			} else if( percentCharge >= 75 ) {
				surcharge = 3; // Sacs preque plein
			} else if( percentCharge >= 50 ) {
				surcharge = 2; // Sacs moitié plein
			} else if( percentCharge >= 25 ) {
				surcharge = 1; // Sacs pas trop plein
			}

			setAttrs({
				"poids_sacs": sacsCharge,
				"personnage_surcharge": surcharge
			});
		});
	}

	function updateRSSum( section, attr, total ) {
		var sum = 0;
		getSectionIDs( section, function(idarray) {
			getAttrs( [ ...idarray.map(id => `${section}_${id}_${attr}`) ], function( sValues ) {
				var v = structSafeFloat( sValues );
				for( var i in idarray ) {
					sum += v[`${section}_${idarray[i]}_${attr}`];
				}
				setAttrs({
					[ total ]: sum
				});
			});

		});
	}

	function updateLivresCharge() {
		getSectionIDs( 'repeating_livres', function(idarray) {
			setAttrs({
				"poids_livres": safeInt( idarray.length )
			});
		});
	}

	function updateMagicSchoolTab( eventInfo ) {
		var sTabs = {};
		var selected = "all";

		getSectionIDs( "repeating_ecolesmagie", function(idarray) {
			for( var i in idarray ) {
				sTabs[ `repeating_ecolesmagie_${idarray[ i ]}_ecolemagie_selected` ] = 0;
			}

			if( eventInfo[ "sourceAttribute" ] === "ecolemagie_selectall" )
			{
				setAttrs( {"tab_ecolemagie": "all" } );
				sTabs[ "ecolemagie_selectall" ] = 1;
			}
			else
			{
				var field = eventInfo[ "sourceAttribute" ].replace( "_selected", "" );
				getAttrs( [ field ], function( v ) {
					setAttrs( { "tab_ecolemagie": v[ field ] } );
				});

				sTabs[ eventInfo[ "sourceAttribute" ] ] = 1;
				sTabs[ "ecolemagie_selectall" ] = 0;
			}

			setAttrs( sTabs, { silent: true } );
		});
	}

	function displayMagicSpells( eventInfo ) {
		var sDisplay = {};

		getSectionIDs( "repeating_magies", function(idarray) {
			getAttrs( [ "tab_ecolemagie", "tab_niveaumagie",
						...idarray.map(id => `repeating_magies_${id}_magie_ecole`),
						...idarray.map(id => `repeating_magies_${id}_magie_niveau`) ], function( v ) {
				var cur_ecole = v[ "tab_ecolemagie" ].trim().toLowerCase();
				var cur_level = v[ "tab_niveaumagie" ];

				for( var i in idarray ) {
					if( ( v[ `repeating_magies_${idarray[ i ]}_magie_ecole` ].trim().toLowerCase() ===  cur_ecole || cur_ecole === "all" ) && ( v[ `repeating_magies_${idarray[ i ]}_magie_niveau` ] ===  cur_level || cur_level === "all" ) ) {
						sDisplay[ `repeating_magies_${idarray[ i ]}_magie_filtre` ] = 1;
					} else {
						sDisplay[ `repeating_magies_${idarray[ i ]}_magie_filtre` ] = 0;
					}
				}
				setAttrs( sDisplay, { silent: true } );
			});
		});
	}

	function start_export() {
		var sJson = {};
		var dataBase = {
			"simple": [ "personnage_nom", "personnage_origine", "personnage_metiers", "personnage_sex", "personnage_age", "personnage_poids", "personnage_taille",
						"ev", "ev_max", "ea", "ea_max", "personnage_niveau", "personnage_xp", "personnage_pointdestin", "bonusdegatssorts",
						"personnage_langue", "personnage_vision", "personnage_nyctalopie", "personnage_ouie", "personnage_odorat", "personnage_charge_max",
						"pr_tete", "pr_bras", "pr_torse", "pr_bouclier", "pr_jambes", "pr_pieds", "pr_mains", "prnat",
						"bivouac_couverture", "bivouac_couverture_recup", "bivouac_matelas", "bivouac_matelas_recup", "bivouac_tente", "bivouac_tente_recup",
						"stats_courage", "stats_courage_mod", "stats_intelligence", "stats_intelligence_mod", "stats_charisme", "stats_charisme_mod", "stats_adresse", "stats_adresse_mod", "stats_force", "stats_force_mod",
						"stats_attaque", "stats_attaque_mod", "stats_parade", "stats_parade_mod", "stats_jet_mod", "stats_esquive_mod", "stats_fouille_mod", "stats_magiephy_mod", "stats_magiepsy_mod", "stats_resimagie_mod",
						"richesse_or", "richesse_argent", "richesse_cuivre", "richesse_berylium", "richesse_thritil", "richesse_billet10", "richesse_billet50", "richesse_billet100", "richesse_billet500", "richesse_billet1000",
						"displayJet"
			],
			"repeating": [
				{ zone:"competences", attr: ["competence_nom", "competence_effet", "competence_epreuve", "competence_jet", "competence_mod"] },
				{ zone:"armes", attr: ["arme_nom", "arme_jet", "arme_at", "arme_prd", "arme_degats", "arme_rup", "arme_effet", "arme_note"] },
				{ zone:"armures", attr: ["armure_nom", "armure_prphy", "armure_prmag", "armure_rup", "armure_effet"] },
				{ zone:"sacs", attr: ["sac_nom", "sac_charge_max"] },
				{ zone:"materiels", attr: ["materiel_nom", "materiel_poids"] },
				{ zone:"gemmes", attr: ["gemme_nom", "gemme_ug"] },
				{ zone:"potions", attr: ["conso_nom", "conso_count", "conso_effet"] },
				{ zone:"coupsspeciaux", attr: ["coupspecial_nom", "coupspecial_jet", "coupspecial_mod", "coupspecial_degats"] },
				{ zone:"munitions", attr: ["munition_nom", "munition_count", "munition_degats", "munition_rup", "munition_effet"] },
				{ zone:"vetements", attr: ["vetement_nom", "vetement_effet"] },
				{ zone:"bourses", attr: ["bourse_nom", "bourse_charge_max"] },
				{ zone:"butins", attr: ["butin_nom", "butin_poids"] },
				{ zone:"quetes", attr: ["quete_nom"] },
				{ zone:"poisons", attr: ["conso_nom", "conso_count", "conso_effet"] },
				{ zone:"bagues", attr: ["bague_nom", "bague_count", "bague_bonus"] },
				{ zone:"ecolesmagie", attr: ["ecolemagie"] },
				{ zone:"reliques", attr: ["relique_nom", "relique_effet"] },
				{ zone:"bouffes", attr: ["bouffe_nom", "bouffe_poids"] },
				{ zone:"livres", attr: ["livre_nom"] },
				{ zone:"antidotes", attr: ["conso_nom", "conso_count", "conso_effet"] },
				{ zone:"magies", attr: ["magie_ecole", "magie_niveau", "magie_nom", "magie_incantation", "magie_duree", "magie_cout", "magie_portee", "magie_aireeffet", "magie_notes", "magie_epreuvelanceur_jet", "magie_epreuvelanceur_mod", "magie_epreuvecible_jet", "magie_epreuvecible_mod", "magie_soin", "magie_degats", "magiebonusint", "magie_effet", "magie_ingre", "creature_ev", "creature_int", "creature_at", "creature_def", "creature_cou", "creature_pr", "creature_xp", "creature_resimagie", "creature_degats", "magie_epreuveappel_mod", "magie_epreuvecontrol_mod", "magie_epreuverevocation_mod"] },
				{ zone:"ingre", attr: ["ingre_nom", "ingre_count"] },
				{ zone:"compagnons", attr: ["compagnon_nom", "compagnon_type", "compagnon_ev", "compagnon_ev_max", "compagnon_cou", "compagnon_at", "compagnon_esquive", "compagnon_prd", "compagnon_charge", "compagnon_charge", "compagnon_pr", "compagnon_resimagie", "compagnon_deplacement_assaut_sol", "compagnon_deplacement_assaut_air", "compagnon_deplacement_charge_sol", "compagnon_deplacement_charge_air", "compagnon_deplacement_voyage_sol", "compagnon_deplacement_voyage_air", "compagnon_deplacement_jour_sol", "compagnon_deplacement_jour_air", "compagnon_combat", "compagnon_entretien", "compagnon_autres", "compagnon_materiel1_nom", "compagnon_materiel2_nom", "compagnon_materiel3_nom", "compagnon_materiel1", "compagnon_materiel2", "compagnon_materiel3"] }
			]
		};
		// get all simple values
		getAttrs( dataBase.simple, function( v ) {
			sJson = v;
			// Get repeating values with recursive function to avoid asynch problems
			getRepeatingFields( dataBase.repeating, 0, sJson );
		});
	}

	function getRepeatingFields( dataBase, i, sJson ) {
		var _aAttr = [];
		var zone = dataBase[ i ][ "zone" ];
		var attr = dataBase[ i ][ "attr" ];
		var i = i + 1;

		// get sections ids
		getSectionIDs( `repeating_${zone}`, function( idarray ) {
			if ( idarray.length > 0 ) {
				for( var j in attr ) {
					_aAttr.push( ...idarray.map(id => `repeating_${zone}_${id}_${attr[ j ]}`) );
				}
				// get all attrs for all sections ids
				getAttrs( _aAttr, function ( v ) {
					var sSection = {};
					// reassemble attrs by id
					for( var key in v ) {
						var id = key.split( '_' )[2];
						// replace the id by a placeholder "rowID" cause we can't import existing ids
						var attr_name = key.replace( id, 'rowID' );

						if( sSection[ id ] === undefined ) {
							sSection[ id ] = {};
						}
						sSection[ id ][ attr_name ] = v[ key ];
					}
					// add an array with all attrs for each sections
					sJson[ zone ] = [];
					for( var id in sSection) {
						sJson[ zone ].push( sSection[ id ] );
					}
					if( dataBase.length > i ) {
						// call recursively getRepeatingFields depending on dataBase.repeating.length
						getRepeatingFields( dataBase, i, sJson);
					} else if( dataBase.length === i ) {
						// or call finish function
						updateExportJson( sJson );
					}
				});
			} else {
				if( dataBase.length > i ) {
					getRepeatingFields( dataBase, i, sJson);
				} else if( dataBase.length === i ) {
					updateExportJson( sJson );
				}
			}
		});
	}

	function updateExportJson( sJson ) {
		// stringify all our simple and repeating attrs / values
		setAttrs( {
			"json_export" : JSON.stringify( sJson ),
			"export_start": 0
		}, { silent: true } );
	}

	function reset_export() {
		setAttrs( {
			"json_export" : "",
			"export_start": 0
		}, { silent: true } );
	}

	function start_import() {
		var err = "";

		getAttrs( [ "json_import", "import_start" ], function ( v ) {
			if( v[ "import_start" ] === "1" )
			{
				// open json
				try {
					var sJson = JSON.parse( v[ "json_import" ] );
				} catch(e) {
					err = "Données non valides";
				}

				if( err === "" ) {
					// reset sheet repeating section
					var aSections = [	"competences","armes","armures","sacs","materiels","gemmes","potions","coupsspeciaux","munitions","vetements","bourses",
										"butins", "quetes","poisons","bagues","ecolesmagie","reliques","bouffes","livres","antidotes","magies","ingre","compagnons" ];
					for( var i in aSections ) {
						var section = `repeating_${aSections[ i ]}`;
						(function( section ) {
							getSectionIDs( section, function(idarray) {
								for( var j in idarray ) {
									removeRepeatingRow( `${section}_${idarray[ j ]}` );
								}
							});
						})(section);
					}

					var sAttrs = {};
					for( var i in sJson ) {
						if( sJson[ i ] instanceof Array ) {
							// import repeating values
							for( var j in sJson[ i ] ) {
								var newid = generateRowID();
								for( var k in sJson[ i ][ j ] ) {
									// replace placeholder 'rowid' by a new generatedID to create rows
									sAttrs[ k.replace( 'rowID', newid ) ] = sJson[ i ][ j ][ k ];
								}
							}
						} else {
							// Import simple values
							sAttrs[ i ] = sJson[ i ];
						}
					}
					setAttrs( sAttrs );
				}

				setAttrs( {
					"json_import": err,
					"import_start": 0
				}, { silent: true } );
			}
		});
	}

	/*----------------
	Version handling
	----------------*/
	on("sheet:opened", function() {
		detect_version();
	});

	function detect_version() {
		getAttrs( [ "version" ], function( v ) {
			var vrs = parseFloat( v[ "version" ] ) || 1.0;
			console.log("Détection de la version : " + vrs );
			if( vrs == 2.1 ) {
				// uptodate
				return;
			} else if( vrs < 2.0 ) {
				getAttrs( [ "level", "valattaque", "valparade", "class", "race", "experience" ], function( v ) {
					if( v[ "level" ] != undefined || v[ "valattaque" ] != undefined || v[ "valparade" ] != undefined || v[ "class" ] != undefined || v[ "race" ] != undefined || v[ "experience" ] != undefined  ) {
						console.log( "Début du process d'import..." );
						update_process();
					}
					console.log( "Mise à jour de la version..." );
					setAttrs( { "version" : 2.1 } );
				});
			}
			console.log( "ok" );
		});
	}

	function update_process() {
		var _aNewAttr = [];
		var _aOldAttr = [];
		var _sNewValues = {};

		// sheet2.0 attr "Character"
		_aNewAttr = _aNewAttr.concat( [ "personnage_nom", "personnage_niveau","personnage_xp","personnage_metiers","personnage_origine","personnage_pointdestin","personnage_langue" ] );
		_aOldAttr = _aOldAttr.concat( [ "charactername", "level","experience","class","race","pointdestin","langue" ] );

		// sheet2.0 attr "stats"
		_aNewAttr = _aNewAttr.concat( [ "stats_courage", "stats_intelligence","stats_charisme","stats_adresse","stats_force" ] );
		_aOldAttr = _aOldAttr.concat( [ "courage","intelligence","charisme","adresse","force" ] );

		// sheet2.0 attr "stats_mod"
		_aNewAttr = _aNewAttr.concat( [ "stats_courage_mod", "stats_intelligence_mod","stats_charisme_mod","stats_adresse_mod","stats_force_mod" ] );
		_aOldAttr = _aOldAttr.concat( [ "couragemod", "intelligencemod","charismemod","adressemod","forcemod" ] );

		// Sheet2.0 attr "richesses"
		_aNewAttr = _aNewAttr.concat( [ "richesse_or","richesse_argent" ] );
		_aOldAttr = _aOldAttr.concat( [ "po","pa" ] );

		// sheet2.0 attr "Combat"
		_aNewAttr = _aNewAttr.concat( [ "ev_max","ea_max","stats_attaque","stats_attaque_mod","stats_parade","stats_parade_mod" ] );
		_aOldAttr = _aOldAttr.concat( [ "evmax","eamax","ValAttaque","ValAttaqueMod","ValParade","ValParadeMod" ] );

		// sheet2.0 attr "magie"
		_aNewAttr = _aNewAttr.concat( [ "stats_magiephy","stats_magiephy_mod","stats_magiepsy","stats_magiepsy_mod","stats_resimagie","stats_resimagie_mod" ] );
		_aOldAttr = _aOldAttr.concat( [ "magiephy","magiephymod","magiepsy","magiepsymod","resimagie","resimagiemod" ] );

		// Sheet2.0 attr "arme"
		_aNewAttr = _aNewAttr.concat( [ "repeating_butins_rowID_butin_nom","repeating_butins_rowID_butin_nom","repeating_butins_rowID_butin_nom","repeating_butins_rowID_butin_nom" ] );
		_aOldAttr = _aOldAttr.concat( [ "arme01","arme02","arme03","arme04" ] );

		// Sheet2.0 attr "armures"
		_aNewAttr = _aNewAttr.concat( [ "repeating_armures_rowID_armure_nom","repeating_armures_rowID_armure_nom","repeating_armures_rowID_armure_nom","repeating_armures_rowID_armure_nom" ] );
		_aOldAttr = _aOldAttr.concat( [ "equip01","equip02","equip03","equip04" ] );

		// Sheet2.0 attr "Inventaire"
		_aNewAttr = _aNewAttr.concat( [ "repeating_materiels_rowID_materiel_nom","repeating_materiels_rowID_materiel_nom","repeating_materiels_rowID_materiel_nom","repeating_materiels_rowID_materiel_nom" ] );
		_aOldAttr = _aOldAttr.concat( [ "inv01","inv02","inv03","inv04" ] );

		// Sheet2.0 attr "Compétences"
		_aNewAttr = _aNewAttr.concat( [ "repeating_competences_rowID_competence_nom","repeating_competences_rowID_competence_nom","repeating_competences_rowID_competence_nom","repeating_competences_rowID_competence_nom" ] );
		_aOldAttr = _aOldAttr.concat( [ "raceability01","raceability02","raceability03","raceability04" ] );

		// Sheet2.0 attr "Compétences"
		_aNewAttr = _aNewAttr.concat( [ "repeating_competences_rowID_competence_nom","repeating_competences_rowID_competence_nom","repeating_competences_rowID_competence_nom","repeating_competences_rowID_competence_nom" ] );
		_aOldAttr = _aOldAttr.concat( [ "classability01","classability02","classability03","classability04" ] );

		// Get the old attr values
		getAttrs( _aOldAttr, function( v ) {
			// Each new attr take the value of the old attr
			for( var i in _aNewAttr ) {
				var _oldAttr = _aOldAttr[ i ];
				var _newAttr = _aNewAttr[ i ];
				var _oldValue = v[ _oldAttr ];

				if( _oldValue != undefined ) {
					// If the new attr is a repeating row > get a rowId
					if( _newAttr.indexOf( "_rowID_" ) !== -1 ) {
						_newAttr = _newAttr.replace( "rowID", generateRowID() );
					}

					_sNewValues[ _newAttr ] = _oldValue;
				}
			}
			// Update
			setAttrs( _sNewValues );
		});

		// old sheet sections attr to new sheet sections attr
		_sNewValues = {};
		var _aOldSections = [
			{
				oldSection: "cac",
				newSection: "armes",
				oldAttr: [ "armenom", "armeat", "armeprd", "armedes", "armedegats" ],
				newAttr: [ "arme_nom", "arme_at", "arme_prd", "arme_degats", "arme_degats" ]
			},
			{
				oldSection: "arme",
				newSection: "butins",
				oldAttr: [ "armes" ],
				newAttr: [ "butin_nom" ]
			},
			{
				oldSection: "equipement",
				newSection: "armures",
				oldAttr: [ "equipement" ],
				newAttr: [ "armure_nom" ]
			},
			{
				oldSection: "inventaire",
				newSection: "materiels",
				oldAttr: [ "inventaire" ],
				newAttr: [ "materiel_nom" ]
			},
			{
				oldSection: "compin",
				newSection: "competences",
				oldAttr: [ "compin" ],
				newAttr: [ "competence_nom" ]
			},
			{
				oldSection: "classabilities",
				newSection: "competences",
				oldAttr: [ "classabilities" ],
				newAttr: [ "competence_nom" ]
			},
			{
				oldSection: "spells",
				newSection: "magies",
				oldAttr: [ "sortnom_1","magietype","sortdesattaque_1","sortdesbonusattaque_1","sortdegatdes_1","sortdegatbonus_1","sortcout_1" ],
				newAttr: [ "magie_nom","magie_epreuvelanceur_jet","magie_epreuvelanceur_mod","magie_epreuvelanceur_mod","magie_degats","magie_degats","magie_cout" ]
			},
			{
				oldSection: "spells",
				newSection: "magies",
				oldAttr: [ "creaturenom_1","invocbonus_1","invoccontrole_1","invocrevoc_1","invoccout_1" ],
				newAttr: [ "magie_nom","magie_epreuveappel_mod","magie_epreuvecontrol_mod","magie_epreuverevocation_mod","magie_cout" ]
			}
		];

		for( var i in _aOldSections ) {
			// Get Old section IDs
			convertRS( _aOldSections[ i ] );
		}
	}

	function convertRS( sOldSections ) {
		var _oldSection = "repeating_" + sOldSections[ "oldSection" ];
		var _newSection = "repeating_" + sOldSections[ "newSection" ];
		var _aOldAttr = [];

		// get sections id of the old Section
		getSectionIDs( _oldSection, function( idarray ) {
			if ( idarray.length > 0 ) {
				_aOldAttr = [];

				// create an array with all attr combine with all ids of the section
				for( var i_oldAttr in sOldSections[ "oldAttr" ] ) {
					_oldAttr = sOldSections[ "oldAttr" ][ i_oldAttr ];
					_aOldAttr.push( ...idarray.map(id => `${_oldSection}_${id}_${_oldAttr}`) );
				}

				// get all values for a section
				getAttrs( _aOldAttr, function (v) {
					var _sNewValues = {}
					for( var i_idarray in idarray ) {

						// Create new rows in new section
						var newrowid = generateRowID();
						var _oldSectionID = _oldSection + "_" + idarray[ i_idarray ] + "_";
						var _newSectionID = _newSection + "_" + newrowid + "_";

						for( var i_attr in sOldSections[ "newAttr" ] ) {
							// Each new attr take the value of the old attr
							var _oldAttr = _oldSectionID + sOldSections[ "oldAttr" ][ i_attr ];
							var _newAttr = _newSectionID + sOldSections[ "newAttr" ][ i_attr ];
							var _oldValue = v[ _oldAttr ];

							if( _oldValue != undefined ) {
								// exceptions
								if( sOldSections[ "oldAttr" ][ i_attr ] === "armedes" || sOldSections[ "oldAttr" ][ i_attr ] === "SortDesAttaque_1" || sOldSections[ "oldAttr" ][ i_attr ] === "SortDegatDes_1" ) {
									_sNewValues[ _newAttr ] = _oldValue + "d6";
								} else if( sOldSections[ "oldAttr" ][ i_attr ] === "armedegats" || sOldSections[ "oldAttr" ][ i_attr ] === "SortDesBonusAttaque_1" || sOldSections[ "oldAttr" ][ i_attr ] === "SortDegatBonus_1" ) {
									_sNewValues[ _newAttr ] = ( _sNewValues[ _newAttr ] || "1d6" ) + "+" + _oldValue;
								} else {
									_sNewValues[ _newAttr ] = _oldValue;
								}
							}
						}
					}
					setAttrs( _sNewValues );
				});
			}
		});
	}
</script>

<rolltemplate class="sheet-rolltemplate-magie">
	<table>
		<tr><th>{{name}}</th></tr>
		<tr>
			<td><span class="tcat">Ecole </span>{{magie_ecole}} - <span class="tcat">Niveau </span>{{magie_niveau}}</td>
		</tr>
		{{#magie_incantation}}
			<tr>
				<td><span class="tcat">Incantation </span>{{magie_incantation}}</td>
			</tr>
		{{/magie_incantation}}
		{{#magie_duree}}
			<tr>
				<td><span class="tcat">Durée </span>{{magie_duree}}</td>
			</tr>
		{{/magie_duree}}
		{{#magie_cout}}
			<tr>
				<td><span class="tcat">Coût </span>{{magie_cout}}</td>
			</tr>
		{{/magie_cout}}
		{{#magie_portee}}
			<tr>
				<td><span class="tcat">Portée </span>{{magie_portee}}</td>
			</tr>
		{{/magie_portee}}
		{{#magie_aireeffet}}
			<tr>
				<td><span class="tcat">Aire d’effet </span>{{magie_aireeffet}}</td>
			</tr>
		{{/magie_aireeffet}}
		{{#magie_display_epreuve}}
			<tr>
				<td><span class="tcat">Épreuve </span>{{magie_epreuve}}</td>
			</tr>
		{{/magie_display_epreuve}}
		{{#magie_display_resistance}}
			<tr>
				<td><span class="tcat">Resistance </span>{{magie_resistance}}</td>
			</tr>
		{{/magie_display_resistance}}
		{{#magie_soin}}
			<tr>
				<td><span class="tcat">Soin </span>{{magie_soin}}</td>
			</tr>
		{{/magie_soin}}
		{{#magie_degats}}
			<tr>
				<td><span class="tcat">Dégats </span>{{magie_degats}} {{#rollGreater() magie_bonusint 0}}+ Bonus Int{{/rollGreater() magie_bonusint 0}}</td>
			</tr>
		{{/magie_degats}}
		<tr>
			<td>{{magie_effet}}</td>
		</tr>
		{{#magie_ingre}}
			<tr>
				<td><span class="tcat">Ingrédients </span><br>{{magie_ingre}}</td>
			</tr>
		{{/magie_ingre}}

		{{#creature_ev}}
			<tr><th>Créature invoquée :</th></tr>
			<tr><td><span class="tcat">EV </span>{{creature_ev}} - <span class="tcat">INT </span>{{creature_int}}</td></tr>
			<tr><td><span class="tcat">AT </span>{{creature_at}} - <span class="tcat">PRD/ESQ </span>{{creature_def}}</td><tr>
			<tr><td><span class="tcat">COU </span>{{creature_cou}} - <span class="tcat">RM </span>{{creature_resimagie}}</td><tr>
			<tr><td><span class="tcat">XP </span>{{creature_xp}} - <span class="tcat">PR </span>{{creature_pr}}</td><tr>
			<tr><td><span class="tcat">Dégats </span>{{creature_degats}}</td><tr>
			<tr><td><span class="tcat">Appel </span>Magie PSY + {{magie_epreuveappel_mod}}</td><tr>
			<tr><td><span class="tcat">Contrôle </span>Magie PSY + {{magie_epreuvecontrol_mod}}</td><tr>
			<tr><td><span class="tcat">Révocation </span>Magie PSY + {{magie_epreuverevocation_mod}}</td><tr>
		{{/creature_ev}}
	</table>
</rolltemplate>

<!-- Version N# --->
<input type="hidden" name="attr_version" value="0">
<!-- AutoCalc fields for sheet worker--->
<input type="hidden" name="attr_Stats_Courage_total" value="0" /> <!-- Courage + CourageMod -->
<input type="hidden" name="attr_Stats_Intelligence_total" value="0" /> <!-- Intelligence + IntelligenceMod -->
<input type="hidden" name="attr_bonusDegatsIntel" value="0" /> <!-- Force + ForceMod -->
<input type="hidden" name="attr_Stats_Charisme_total" value="0" /> <!-- Charisme + CharismeMod -->
<input type="hidden" name="attr_Stats_Adresse_total" value="0" /> <!-- Adresse + AdresseMod -->
<input type="hidden" name="attr_Stats_Force_total" value="0" /> <!-- Force + ForceMod -->
<input type="hidden" name="attr_bonusDegatsForce" value="0" /> <!-- Force + ForceMod -->
<input type="hidden" name="attr_Stats_Attaque_total" value="8" /> <!-- Attaque + AttaqueMod -->
<input type="hidden" name="attr_Stats_Parade_total" value="10" /> <!-- Parade + ParadeMod -->
<input type="hidden" name="attr_Stats_Jet_total" value="0" /> <!-- Adresse_total + JetMod -->
<input type="hidden" name="attr_Stats_Esquive_total" value="0" /> <!-- AD_total + EsquiveMod --->
<input type="hidden" name="attr_Stats_Fouille_total" value="0" /> <!-- Intelligence_total + FouilleMod -->
<input type="hidden" name="attr_Stats_MagiePhy_total" value="0" /> <!-- MagiePhys + MagiePhysMod -->
<input type="hidden" name="attr_Stats_MagiePsy_total" value="0" /> <!-- MagiePsy + MagiePsyMod -->
<input type="hidden" name="attr_Stats_ResiMagie_total" value="0" /> <!-- ResiMagie + ResiMagie_total -->
<input type="hidden" name="attr_Poids_Materiels" value="0" /> <!-- temp charge du materiel -->
<input type="hidden" name="attr_Poids_Butins" value="0" /> <!-- temp charge du butin -->
<input type="hidden" name="attr_Poids_Livres" value="0" /> <!-- temp charge des livres -->
<input type="hidden" name="attr_Poids_Bouffes" value="0" /> <!-- temp charge de la bouffe -->

<div class="sheet-wrapper">

	<div class="sheet-header">
		<div class="sheet-col-float" style="width:150px">
			<img src="https://www.dropbox.com/s/j8lz0dbrxmxbeqs/logo.png?raw=1" />
		</div>
		<div class="sheet-col-float" style="width:600px">
			<div class="sheet-col-float">Nom : </div>
			<div class="sheet-col-float" style="width:130px">
				<input type="text" name="attr_Personnage_Nom" class="sheet-noBorder">
			</div>
			<div class="sheet-col-float">Origine : </div>
			<div class="sheet-col-float" style="width:130px">
				<input type="text" name="attr_Personnage_Origine" class="sheet-noBorder">
			</div>
			<div class="sheet-col-float">Métier(s) : </div>
			<div class="sheet-col-float" style="width:130px">
				<input type="text" name="attr_Personnage_Metiers" class="sheet-noBorder">
			</div>
			<br clear="all" />
			<div class="sheet-col-float">Sexe : </div>
			<div class="sheet-col-float" style="width:92px;">
				<input type="text" class="sheet-noBorder" name="attr_Personnage_Sex" >
			</div>
			<div class="sheet-col-float">Âge : </div>
			<div class="sheet-col-float" style="width:92px;">
				<input type="text" class="sheet-noBorder" name="attr_Personnage_Age">
			</div>
			<div class="sheet-col-float">Taille : </div>
			<div class="sheet-col-float" style="width:92px;">
				<input type="text" class="sheet-noBorder" name="attr_Personnage_Taille">
			</div>
			<div class="sheet-col-float">Poids : </div>
			<div class="sheet-col-float" style="width:92px;">
				<input type="text"  class="sheet-noBorder"name="attr_Personnage_Poids">
			</div>
		</div>
	</div>
	<input type="checkbox" class="sheet-display-pnj" name="attr_tab_pnj" value="1" title="Personnage Non Joueur" /><span class="display-pnj"></span>
	<input type="checkbox" class="sheet-display-reglages" name="attr_tab_reglages" value="1" title="Réglages" /><span class="sheet-cog sheet-display-reglages">y</span>

	<br clear="all" />

	<div class="sheet-body sheet-pj">
		<input type="radio" name="attr_tab_nav" class="sheet-tab sheet-tab_caracteristiques" value="caracteristiques" title="Caractéristiques" checked="checked" /><span class="tab">Caractéristiques</span>
		<input type="radio" name="attr_tab_nav" class="sheet-tab sheet-tab_competences" value="competences" title="Compétences" /><span class="sheet-tab">Compétences</span>
		<input type="radio" name="attr_tab_nav" class="sheet-tab sheet-tab_equipement" value="equipement" title="Equipement" /><span class="sheet-tab">Equipement</span>
		<input type="radio" name="attr_tab_nav" class="sheet-tab sheet-tab_magie" value="magie" title="Compétences" /><span class="sheet-tab">Magie</span>
		<input type="radio" name="attr_tab_nav" class="sheet-tab sheet-tab_inventaire" value="inventaire" title="Inventaire" /><span class="sheet-tab">Inventaire</span>
		<input type="radio" name="attr_tab_nav" class="sheet-tab sheet-tab_compagnons" value="compagnons" title="Compagnons" /><span class="sheet-tab">Compagnons</span>
		<br />
		<br />

		<!-- TAB Caractéristiques -->
		<div class="sheet-tab_caracteristiques">
			<div class="sheet-col-float" style="width:360px;">
				<div class="sheet-stats">
					<h2>Caractéristiques</h2>
					<table>
						<thead>
							<tr>
								<th width="130"></th>
								<th width="70">Score</th>
								<th width="70">Mod.</th>
								<th width="70">Épreuve</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<th title="La bravoure du personnage face au danger et à la mort, ainsi que sa rapidité à se décider">Courage</th>

								<td><input type="number" name="attr_Stats_Courage" value="0"></td>
								<td><input type="number" name="attr_Stats_Courage_mod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente une épreuve de Courage }} {{ Courage=@{Stats_Courage_total} }} {{ Résultat=[[1d20]] }}" name="roll_Courage" /></td>
							</tr>
							<tr>
								<th title="La capacité à réfléchir et l'érudition">Intelligence</th>
								<td><input type="number" name="attr_Stats_Intelligence" value="0"></td>
								<td><input type="number" name="attr_Stats_Intelligence_mod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente une épreuve d'Intelligence }} {{ Intelligence=@{Stats_Intelligence_total} }} {{ Résultat=[[1d20]] }}" name="roll_Intelligence" /></td>
							</tr>
							<tr>
								<th title="La beauté physique et la capacité à convaincre les autres">Charisme</th>
								<td><input type="number" name="attr_Stats_Charisme" value="0"></td>
								<td><input type="number" name="attr_Stats_Charisme_mod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente une épreuve de Charisme}} {{ Charisme=@{Stats_Charisme_total} }} {{ Résultat=[[1d20]] }}" name="roll_Charisme" /></td>
							</tr>
							<tr>
								<th title="L'agilité, la souplesse et la précision">Adresse</th>
								<td><input type="number" name="attr_Stats_Adresse" value="0"></td>
								<td><input type="number" name="attr_Stats_Adresse_mod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente une épreuve d'Adresse}} {{ Adresse=@{Stats_Adresse_total} }} {{ Résultat=[[1d20]] }}" name="roll_Adresse" /></td>
							</tr>
							<tr>
								<th title="La capacité musculaire du personnage, qui influe sur la résistance">Force</th>
								<td><input type="number" name="attr_Stats_Force" value="0"></td>
								<td><input type="number" name="attr_Stats_Force_mod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente une épreuve de Force}} {{ Force=@{Stats_Force_total} }} {{ Résultat=[[1d20]] }}" name="roll_Force" /></td>
							</tr>
							<tr>
								<td colspan="4">&nbsp;</td>
							</tr>
							<tr>
								<th title="Chance de toucher son adversaire">Attaque</th>
								<td><input type="number" name="attr_Stats_Attaque" value="8"></td>
								<td><input type="number" name="attr_Stats_Attaque_mod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente une Attaque }} {{ Attaque=@{Stats_Attaque_total} }} {{ Résultat=[[1d20]] }}" name="roll_Attaque" /></td>
							</tr>
							<tr>
								<th title="Chance de Parer son adversaire">Parade</th>
								<td><input type="number" name="attr_Stats_Parade" value="10"></td>
								<td><input type="number" name="attr_Stats_Parade_mod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente une Parade }} {{ Parade=@{Stats_Parade_total} }} {{ Résultat=[[1d20]] }}" name="roll_Parade" /></td>
							</tr>
							<tr>
								<th title="Chance de toucher avec les armes à distance">Jet</th>
								<td title="Calculée en fonction de l'Adresse"><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_Stats_Jet" value="0" readonly="readonly"></td>
								<td><input type="number" name="attr_Stats_Jet_mod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente une Attaque à distance }} {{ Jet=@{Stats_Jet_total} }} {{ Résultat=[[1d20]] }}" name="roll_Jet" /></td>
							</tr>
							<tr>
								<th title="Le héros qui Esquive va se déplacer rapidement d'environ 2 mètres">Esquive</th>
								<td title="Calculée en fonction de l'Adresse, la PR phy et l'encombrement"><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_Stats_Esquive" value="0" readonly="readonly"></td>
								<td><input type="number" name="attr_Stats_Esquive_mod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente une Esquive }} {{ Esquive=@{Stats_Esquive_total} }} {{ Résultat=[[1d20]] }}" name="roll_Esquive" /></td>
							</tr>
							<tr>
								<th title="Change de trouver des objets / indices">Fouille</th>
								<td title="Calculée en fonction de l'Intelligence"><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_Stats_Fouille" value="0" readonly="readonly"></td>
								<td><input type="number" name="attr_Stats_Fouille_mod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} commence à Fouiller }} {{ Fouille=@{Stats_Fouille_total} }} {{ Résultat=[[1d20]] }}" name="roll_Fouille" /></td>
							</tr>
							<tr>
								<td colspan="4">&nbsp;</td>
							</tr>
							<tr>
								<th tile="Chance de réussir une Magie Physique">Magie Phys.<br><span class="sheet-hint">Moyenne INT et AD</span></th>
								<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_Stats_MagiePhy" value="0" readonly="readonly"></td>
								<td><input type="number" name="attr_Stats_MagiePhy_mod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} concentre sa Magie}} {{ Magie Phys=@{Stats_MagiePhy_total} }} {{ Résultat=[[1d20]] }}" name="roll_MagiePhys" /></td>
							</tr>
							<tr>
								<th tile="Chance de réussir une Magie Psychique">Magie Psy.<br><span class="sheet-hint">Moyenne INT et CHA</span></th>
								<td tile="Calculée en fonction de l'Int"><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_Stats_MagiePsy" value="0" readonly="readonly"></td>
								<td><input type="number" name="attr_Stats_MagiePsy_mod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} concentre sa Magie }} {{ Magie Psy=@{Stats_MagiePsy_total} }} {{ Résultat=[[1d20]] }}" name="roll_MagiePsy" /></td>
							</tr>
							<tr>
								<th>Résist. Magie<br><span class="sheet-hint">Moyenne COU, INT et FO</span></th>
								<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_Stats_ResiMagie" value="0" readonly="readonly"></td>
								<td><input type="number" name="attr_Stats_ResiMagie_mod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente de résiter à la Magie}} {{ Résist. Magie=@{Stats_ResiMagie_total} }} {{ Résultat=[[1d20]] }}" name="roll_ResistMagie" /></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<div class="sheet-col-float" style="width:160px;">
				<div class="sheet-energie">
					<h2>Energie</h2>
					<table style="margin:auto;">
						<tr>
							<th colspan="3">Energie Vitale (EV) :</th>
						</tr>
						<tr>
							<td><input type="number" name="attr_EV" value="0" step="1"></td>
							<td>/</td>
							<td><input type="number" name="attr_EV_max" value="0" min="1" step="1"></td>
						</tr>
						<tr>
							<th colspan="3">Energie Astrale (EA)</th>
						</tr>
						<tr>
							<td><input type="number" name="attr_EA" value="0" step="1"></td>
							<td>/</td>
							<td><input type="number" name="attr_EA_max" value="0" min="0" step="1"></td>
						</tr>
					</table>
				</div>
				<br />
				<div class="sheet-xp">
					<div class="sheet-hex sheet-hex-3" style="background-color: #766344; width: 100px; height: 57px">
						<div class="sheet-inner">
							<h4>Niveau</h4>
							<input type="number" class="sheet-square" name="attr_Personnage_Niveau" min="1" step="1" value="1"  />
						</div>
						<div class="sheet-corner-1"></div>
						<div class="sheet-corner-2"></div>
					</div>
					<br clear="all" />
					<h2>Expérience (xp)</h2>
					<table style="margin:auto;">
						<tr>
							<td><input type="number" name="attr_Personnage_XP" value="0"></td>
							<td>/</td>
							<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_Personnage_XP_max" value="100"></td>
						</tr>
					</table>
					<br />
					<h2>Points de destin</h2>
					<span class="sheet-hint">Pour éviter de mourir trop tôt...</span>
					<table style="margin:auto;">
						<tr>
							<td style="text-align:center;"><input type="number" name="attr_Personnage_PointDestin" value="0"></td>
						</tr>
					</table>
				</div>
			</div>
			<div class="sheet-col-float" style="width:260px">
				<div class="sheet-sens">
					<h2>Sens</h2>
					<table>
						<tr>
							<th>Langue(s)</th>
							<td><input type="text" class="sheet-noBorder" name="attr_Personnage_Langue" value="" placeholder="Commun" /></td>
						</tr>
						<tr>
							<th>Vision</th>
							<td><input type="text" class="sheet-noBorder" name="attr_Personnage_Vision" value="" placeholder="Standard" /></td>
						</tr>
						<tr>
							<th>Nyctalopie</th>
							<td><input type="text" class="sheet-noBorder" name="attr_Personnage_Nyctalopie" value="" placeholder="non" /></td>
						</tr>
						<tr>
							<th>Ouïe</th>
							<td><input type="text" class="sheet-noBorder" name="attr_Personnage_Ouie" value="" placeholder="Standard" /></td>
						</tr>
						<tr>
							<th>Odorat</th>
							<td><input type="text" class="sheet-noBorder" name="attr_Personnage_Odorat" value="" placeholder="Standard" /></td>
						</tr>
					</table>
				</div>
				<br />
				<div class="sheet-sens">
					<h2>Déplacement</h2>
					<table>
						<tr>
							<th>Rapide</th>
							<td title="Calculée en fonction de la PR Phy."><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_DeplacementRapide" value="8" readonly="readonly" /> m / assault</td>
						</tr>
						<tr>
							<th>Durée</th>
							<td title="Calculée en fonction de la Force"><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_DeplacementRapide_Duree" value="20" readonly="readonly" /> sec</td>
						</tr>
						<tr>
							<th>Sprint (*)</th>
							<td title="Calculée en fonction de la PR Phy."><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_DeplacementSprint" value="12" readonly="readonly" /> m / assault</td>
						</tr>
						<tr>
							<th>Durée</th>
							<td title="Calculée en fonction de la Force"><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_DeplacementSprint_Duree" value="5" readonly="readonly" /> sec</td>
						</tr>
					</table>
					<span class="sheet-hint">* Après un assaut en déplacement rapide, on est considéré comme lancé et on peut sprinter.</span>
				</div>
				<br />
				<h2>Confrontation</h2>
				<table style="margin:auto;">
					<tr>
						<td style="text-align:center;">
							<select name="attr_Confrontation_jet">
								<option value="" selected="selected"></option>
								<option value="COU : @{Stats_Courage_total}">COU</option>
								<option value="INT : @{Stats_Intelligence_total}">INT</option>
								<option value="CHA : @{Stats_Charisme_total}">CHA</option>
								<option value="AD : @{Stats_Adresse_total}">AD</option>
								<option value="FO : @{Stats_Force_total}">FO</option>
								<option value="AT : @{Stats_Attaque_total}">AT</option>
								<option value="PRD : @{Stats_Parade_total}">PRD</option>
								<option value="Magie Phy. : @{Stats_MagiePhy_total}">Magie Phy.</option>
								<option value="Magie Psy. : @{Stats_MagiePsy_total}">Magie Psy.</option>
								<option value="Résist. Magie : @{Stats_MagiePsy_total}">Résist. Magie</option>
							</select>
						</td>
						<td style="text-align:center;"><input type="text" class="sheet-shortInput" name="attr_Confrontation_mod" value="2d6"></td>
						<td><button type="roll" value="@{displayJet} &{template:default} {{name=Confrontation de @{Personnage_Nom} }} {{ Résultat = @{Confrontation_jet} + [[@{Confrontation_mod}]] }}" name="roll_Confrontation" /></td>
					</tr>
				</table>
			</div>
			<br clear="all" />
			<br>
			<span class="sheet-hint" style="display:block" name="attr_BonusIntel"></span>
			<span class="sheet-hint" style="display:block" name="attr_BonusAdresse"></span>
			<span class="sheet-hint" style="display:block" name="attr_BonusForce"></span>
		</div>

		<!-- TAB Compétences --->
		<div class="sheet-tab_competences">
			<div class="sheet-competences">
				<h2>Compétences</h2>
				<div class="sheet-tableth">
					<div class="sheet-col" style="width: 236px;">Compétence</div>
					<div class="sheet-col" style="width: 216px;">Effets</div>
					<div class="sheet-col" style="width: 66px;">Épreuve ?</div>
					<div class="sheet-col" style="width: 66px;">Stat.</div>
					<div class="sheet-col" style="width: 86px;">Mod.</div>
					<div class="sheet-col" style="width: 76px;">Épreuve</div>
				</div>
				<fieldset class="repeating_competences">
					<div class="sheet-row">
						<div class="sheet-col" style="width: 240px;height: 37px">
							<input type="text" class="sheet-noBorder" name="attr_Competence_Nom" value="" />
						</div>
						<div class="sheet-col" style="width: 240px;">
							<input type="text" class="sheet-noBorder" name="attr_Competence_Effet" value="" />
						</div>
						<div class="sheet-col" style="width: 330px;">
							<input type="checkbox" class="sheet-display-competenceEpreuve" name="attr_Competence_Epreuve" value="1" />
							<div class="sheet-display-competenceEpreuve">
								<div class="sheet-col" style="width: 50px;"></div>
								<div class="sheet-col" style="width: 70px;">
									<select name="attr_Competence_Jet">
										<option value="COU : @{Stats_Courage_total}">COU</option>
										<option value="INT : @{Stats_Intelligence_total}">INT</option>
										<option value="CHA : @{Stats_Charisme_total}">CHA</option>
										<option value="AD : @{Stats_Adresse_total}">AD</option>
										<option value="FO : @{Stats_Force_total}">FO</option>
									</select>
								</div>
								<div class="sheet-col" style="width: 90px;">
									<input type="number" name="attr_Competence_mod" value="0" />
								</div>
								<div class="sheet-col" style="width: 80px;">
									<button type="roll" value="@{displayJet} &{template:default} {{name=Épreuve de @{Competence_Nom} par @{Personnage_Nom} }} {{Épreuve=@{Competence_Jet} + @{Competence_mod} }} {{ Résultat=[[1d20]] }}" name="roll_Competences"> Épreuve</button>
								</div>
							</div>
						</div>
					</div>
				</fieldset>
			</div>
			<br />
			<div class="sheet-coupsspeciaux">
				<h2>Coups spéciaux</h2>
				<div class="sheet-tableth">
					<div class="sheet-col" style="width: 236px;">Coup</div>
					<div class="sheet-col" style="width: 76px;">Stat.</div>
					<div class="sheet-col" style="width: 86px;">Mod.</div>
					<div class="sheet-col" style="width: 86px;">Dégats</div>
					<div class="sheet-col" style="width: 166px;">Jets</div>
				</div>
				<fieldset class="repeating_coupsSpeciaux">
					<div class="sheet-row">
						<div class="sheet-col" style="width: 250px;">
							<input type="text" class="sheet-noBorder" name="attr_CoupSpecial_Nom" value="" />
						</div>
						<div class="sheet-col" style="width: 80px;">
							<select name="attr_CoupSpecial_Jet">
								<option value="AT : @{Stats_Attaque_total}">AT</option>
								<option value="AD : @{Stats_Adresse_total}">AD</option>
								<option value="FO : @{Stats_Force_total}">FO</option>
								<option value="AD/FO : [[ceil((@{Stats_Force_total}+@{Stats_Adresse_total})/2)]]">AD/FO</option>
							</select>
						</div>
						<div class="sheet-col" style="width: 90px;">
							<input type="number" name="attr_CoupSpecial_mod" value="0" />
						</div>
						<div class="sheet-col" style="width: 90px;">
							<input type="text" class="sheet-shortInput" name="attr_CoupSpecial_Degats" value="1d6" />
						</div>
						<div class="sheet-col" style="width: 270px;">
							<button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} prépare son coup spécial @{CoupSpecial_Nom} }} {{ Épreuve=@{CoupSpecial_Jet} + @{CoupSpecial_mod} }} {{ Résultat=[[1d20]] }}" > Épreuve</button>
							<button type="roll" class="sheet-rollDegats" value="@{displayJet} &{template:default} {{name=Dégats de @{Personnage_Nom} avec @{CoupSpecial_Nom}}} {{ Dégats=[[@{CoupSpecial_Degats}+@{BonusDegatsForce}]] }}" > Dégats</button>
						</div>
					</div>
				</fieldset>
			</div>
		</div>

		<!-- TAB Equipement --->
		<div class="sheet-tab_equipement">
			<div class="sheet-armes">
				<h2>Armement & Baston</h2>
				<div class="sheet-tableth">
					<div class="sheet-col" style="width: 256px;">Arme</div>
					<div class="sheet-col" style="width: 66px;">Portée</div>
					<div class="sheet-col" style="width: 66px;">Mod. AT</div>
					<div class="sheet-col" style="width: 66px;">Mod. PRD</div>
					<div class="sheet-col" style="width: 66px;">Dégats</div>
					<div class="sheet-col" style="width: 66px;">RUP.</div>
					<div class="sheet-col" style="width: 166px;">Jets</div>
				</div>

				<fieldset class="repeating_armes">

					<div class="sheet-row" style="background-color: #eee;padding: 5px; border-radius: 10px;">
						<div class="sheet-col" style="width: 260px;">
							<input type="text" class="sheet-noBorder" name="attr_Arme_Nom" value="" />
						</div>
						<div class="sheet-col" style="width: 70px;">
							<select name="attr_Arme_Jet">
								<option value="@{Stats_Attaque_total}" selected="selected">Mélée</option>
								<option value="@{Stats_Jet_total}">Dist.</option>
							</select>
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="number" name="attr_Arme_AT" value="0" />
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="number" name="attr_Arme_PRD" value="0" />
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="text" class="sheet-shortInput" name="attr_Arme_Degats" value="1d6" />
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="text" class="sheet-shortInput" name="attr_Arme_RUP" value="" />
						</div>
						<div class="sheet-col" style="width: 170px;">
							<button type="roll" value="@{displayJet} &{template:default} {{name=Attaque de @{Personnage_Nom} avec @{Arme_Nom} }} {{ AT=@{Arme_Jet} + @{Arme_At} }} {{ Résultat=[[1d20]] }}"> AT </button>
							<button type="roll" value="@{displayJet} &{template:default} {{name=Parade de @{Personnage_Nom} avec @{Arme_Nom} }} {{ PRD=@{Stats_Parade_total} + @{Arme_PRD} }} {{ Résultat=[[1d20]] }}"> PRD </button>
							<button type="roll" class="sheet-rollDegats" value="@{displayJet} &{template:default} {{name=Dégats de @{Personnage_Nom} avec @{Arme_Nom}}} {{ Dégats=[[@{Arme_Degats} + @{BonusDegatsForce}]] }}"> Dégats </button>
						</div>
						<br clear="all" />
						<div class="sheet-col" style="width: 100px;padding-top: 5px;">
							<b>Bonus / Effets</b>
						</div>
						<div class="sheet-col" style="width: 250px;">
							<input type="text" class="sheet-noBorder" name="attr_Arme_Effet" value="" />
						</div>
						<div class="sheet-col" style="width: 150px;padding-top: 5px; text-align:right">
							<b>Notes et détails</b>
						</div>
						<div class="sheet-col" style="width: 250px;">
							<input type="text" class="sheet-noBorder" name="attr_Arme_Note" value="" />
						</div>
					</div>
					<br clear="all" />
				</fieldset>
				<br>
				<span class="sheet-hint">Le Bonus / Malus aux dégats octroyé par la Force est inclus automatiquement dans les jets de dégats : <input class="sheet-shortInput sheet-autoCalc" name="attr_BonusDegatsForce" value="0" readonly="readonly" type="text"></span>
			</div>
			<br />
			<div class="sheet-munitions">
				<input type="checkbox" class="sheet-display display-munitions" name="attr_displayMunitions" value="1" checked="checked" /><h2 class="sheet-display">Munitions</h2>
				<div class="sheet-display-munitions">
					<div class="sheet-tableth">
						<div class="sheet-col" style="width: 296px;"></div>
						<div class="sheet-col" style="width: 66px;">Nb.</div>
						<div class="sheet-col" style="width: 66px;">Dégats</div>
						<div class="sheet-col" style="width: 66px;">RUP.</div>
						<div class="sheet-col" style="width: 246px;">Bonus / Effets</div>
					</div>
					<fieldset class="repeating_munitions">
						<div class="sheet-row">
							<div class="sheet-col" style="width: 300px;">
								<input type="text" class="sheet-noBorder" name="attr_Munition_Nom" value="" />
							</div>
							<div class="sheet-col" style="width: 70px;">
								<input type="number" name="attr_Munition_Count" value="" />
							</div>
							<div class="sheet-col" style="width: 70px;">
								<input type="text" class="sheet-shortInput" name="attr_Munition_Degats" value="" />
							</div>
							<div class="sheet-col" style="width: 70px;">
								<input type="text" class="sheet-shortInput" name="attr_Munition_RUP" value="" />
							</div>
							<div class="sheet-col" style="width: 250px;">
								<input type="text" class="sheet-noBorder" name="attr_Munition_Effet" value="" />
							</div>
						</div>
					</fieldset>
				</div>
			</div>
			<br />
			<div class="sheet-bagues">
				<input type="checkbox" class="sheet-display display-bagues" name="attr_displayBagues" value="1" checked="checked" /><h2 class="sheet-display">Objets chargés (Bagues, Pendentifs, Broches...)</h2>
				<div class="sheet-display-bagues">
					<div class="sheet-tableth">
						<div class="sheet-col" style="width: 296px;"></div>
						<div class="sheet-col" style="width: 76px;">Charges</div>
						<div class="sheet-col" style="width: 246px;">Bonus / Effets</div>
					</div>
					<fieldset class="repeating_bagues">
						<div class="sheet-row">
							<div class="sheet-col" style="width: 300px;">
								<input type="text" class="sheet-noBorder" name="attr_Bague_Nom" value="" />
							</div>
							<div class="sheet-col" style="width: 70px;">
								<input type="number" name="attr_Bague_Count" value="" />
							</div>
							<div class="sheet-col" style="width: 250px;">
								<input type="text" class="sheet-noBorder" name="attr_Bague_Bonus" value="" />
							</div>
						</div>
					</fieldset>
				</div>
			</div>
			<br />
			<div class="sheet-armure">
				<h2>Armures & Protections</h2>

				<div class="sheet-tableth">
					<div class="sheet-col" style="width: 256px;">Pièce d'Armure</div>
					<div class="sheet-col" style="width: 66px;">PR Phys.</div>
					<div class="sheet-col" style="width: 66px;">PR Mag.</div>
					<div class="sheet-col" style="width: 66px;">RUP.</div>
					<div class="sheet-col" style="width: 296px;">Bonus / Effets</div>
				</div>
				<fieldset class="repeating_armures">
					<div class="sheet-row">
						<div class="sheet-col" style="width: 260px;">
							<input type="text" class="sheet-noBorder" name="attr_Armure_Nom" value="" />
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="number" name="attr_Armure_PRPhy" value="0" />
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="number" name="attr_Armure_PRMag" value="0" />
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="text" class="sheet-shortInput" name="attr_Armure_RUP" value="" />
						</div>
						<div class="sheet-col" style="width: 300px;">
							<input type="text" class="sheet-noBorder" name="attr_Armure_Effet" value="" />
						</div>
					</div>
				</fieldset>

				<br clear="all" />
				<br />

				<div class="sheet-col-float" style="width:40%">
					<div class="sheet-armure-pieces">
						<table style="margin:auto;">
							<tr>
								<td></td>

								<th>Tête</th>
								<td></td>
							</tr>
							<tr>
								<th style="text-align:center;">Bras</th>
								<td rowspan="2"><input type="number" class="sheet-square" name="attr_PR_Tete" value="0" /></td>
								<td></td>
							</tr>
							<tr>
								<td rowspan="2" style="text-align:center;"><input type="number" class="sheet-square" name="attr_PR_Bras" value="0" /></td>
								<td rowspan="2"></td>
							</tr>
							<tr>
								<th style="text-align:center;">Torse</th>
							</tr>
							<tr>
								<th style="text-align:center;">Mains</th>
								<td rowspan="2" style="text-align:center;"><input type="number" class="sheet-square" name="attr_PR_Torse" value="0" /></td>.
								<th style="text-align:center;">Bouclier</th>
							</tr>
							<tr>
								<td rowspan="2" style="text-align:center;"><input type="number" class="sheet-square" name="attr_PR_Mains" value="0" /></td>
								<td rowspan="2" style="text-align:center;"><input type="number" class="sheet-square" name="attr_PR_Bouclier" value="0" /></td>
							</tr>
							<tr>
								<th style="text-align:center;">Jambes</th>
							</tr>
							<tr>
								<td></td>
								<td rowspan="2" style="text-align:center;"><input type="number" class="sheet-square" name="attr_PR_Jambes" value="0" /></td>
								<th style="text-align:center;">Pieds</th>
							</tr>
							<tr>
								<td></td>
								<td style="text-align:center;"><input type="number" class="sheet-square" name="attr_PR_Pieds" value="0" /></td>
							</tr>
						</table>
					</div>
					<br />
					<div class="sheet-col-float" style="width:60%;">
						<table>
							<thead>
								<th colspan="2">PR détaillée</th>
							</thead>
							<tr>
								<th title="Protection par l'Origine ou Compétences - Protège toutes les localisations du corps">PR Naturelle</th>
								<td><input type="number" name="attr_PRNat" value="0" /></td>
							</tr>
							<tr>
								<th title="Protection par l'Armure">PR Physique</th>
								<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_PRPhy" value="0" readonly="readonly" /></td>
							</tr>
							<tr>
								<th title="Protection par la Magie - Protège toutes les localisations du corps">PR Magique</th>
								<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_PRMag" value="0" readonly="readonly" /></td>
							</tr>
							<tr>
								<td colspan="2"><span class="sheet-hint">PR : Valeur de protection</span></td>
							</tr>
						</table>
					</div>
					<div class="sheet-col-float" style="width:30%;">
						<table style="width:100%;">
							<thead>
								<th>PR Totale</th>
							</thead>
							<tr>
								<td style="text-align:center;"><input type="text" class="sheet-square sheet-autoCalc" name="attr_PR" value="0" readonly="readonly" /></td>
							</tr>
						</table>
					</div>
				</div>

				<div class="sheet-col-float">
					<div class="sheet-tableth">
						<div class="sheet-col" style="width: 246px;">Vêtements</div>
						<div class="sheet-col" style="width: 196px;">Bonus / Effets</div>
					</div>
					<fieldset class="repeating_vetements">
						<div class="sheet-row">
							<div class="sheet-col" style="width: 250px;">
								<input type="text" class="sheet-noBorder" name="attr_Vetement_Nom" value="" />
							</div>
							<div class="sheet-col" style="width: 200px;">
								<input type="text" class="sheet-noBorder" name="attr_Vetement_Effet" value="" />
							</div>
						</div>
					</fieldset>
				</div>
			</div>
		</div>

		<!-- TAB Magie -->
		<div class="sheet-tab_magie">
			<div class="sheet-col-float" style="width:120px;">
				<div class="sheet-tableth" style="padding: 4px; font-size: 11px;"> v Ecoles / Niveaux > </div>
				<input type="checkbox" name="attr_ecoleMagie_SelectALL" class="sheet-tab" value="1" checked="checked" /><span class="sheet-tab">Toutes</span>
				<br /><br />
				<fieldset class="repeating_EcolesMagie">
					<input type="checkbox" name="attr_EcoleMagie_Selected" class="sheet-tab" value="1" /><span class="sheet-tab" name="attr_EcoleMagie">&nbsp;</span>
					<input type="checkbox" name="attr_EcoleMagie_Modal" class="sheet-modal" value="1" /><span class="sheet-cog">y</span>
					<div class="sheet-modal-wrapper">
						<div class="sheet-modal" style="height:100px;">
							<div class="sheet-modal_header">
								<h2>Ecole de magie : <span class="sheet-close">*</span><input type="checkbox" class="sheet-modal" name="attr_EcoleMagie_Modal" value="1" /></h2>
							</div>
							<div class="sheet-modal_body" style="text-align:center;">
								<input type="text" class="sheet-noBorder" name="attr_EcoleMagie" value="Généraliste" />
							</div>
						</div>
					</div>
					<br />
					<br />
				</fieldset>
				<br clear="all" />
				<input type="hidden" name="attr_tab_EcoleMagie" class="sheet-tab" value="" />
				<input type="checkbox" name="attr_modal_HowToMagie" class="sheet-modal" value="1" /><span class="sheet-cog">?</span> <span class="sheet-hint"> Comment ça marche ?</span>
				<div class="sheet-modal-wrapper">
					<div class="sheet-modal" style="height:300px;">
						<div class="sheet-modal_header">
							<h2>La magie, comment ca marche ? <span class="sheet-close">*</span><input type="checkbox" class="sheet-modal" name="attr_modal_HowToMagie" value="1" /></h2>
						</div>
						<div class="sheet-modal_body">
							<b>Avant toute chose :</b><br />
							<ol>
								<li>Commencez par ajouter des écoles de magie dans la colonne de gauche</li>
								<li>Pour renommer une école, cliquez sur la roue dentée en face</li>
							</ol>
							<br />
							<b>Ajouter un sort :</b><br />
							<ol>
								<li>Créez un nouveau sort</li>
								<li>Inscrivez l'école de magie du sort (attention l'école de magie doit éxister dans la liste de gauche !)</li>
								<li>Sélectionnez le niveau du sort</li>
								<li>Configurez votre sort (portée, épreuve, dégats...), il sera automatiquement associé à l'école et au niveau séléctionnés en cas de filtre.</li>
							</ol>
							<br />
							<b>Mon sort a disparu ? :</b><br />
							<ol>
								<li>Cochez la case "Toutes les écoles de magies"</li>
								<li>Vérifiez que l'école du sort est bien <b><u>strictement identique</u></b> à une des écoles de magies</li>
							</ol>
						</div>
					</div>
				</div>
			</div>
			<div class="sheet-col-float" style="width:680px; text-align:center;">
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="0" checked="checked" title="Multi-niveau" /><span class="sheet-rounded-tab">M</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="1" /><span class="sheet-rounded-tab">1</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="2" /><span class="sheet-rounded-tab">2</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="3" /><span class="sheet-rounded-tab">3</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="4" /><span class="sheet-rounded-tab">4</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="5" /><span class="sheet-rounded-tab">5</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="6" /><span class="sheet-rounded-tab">6</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="7" /><span class="sheet-rounded-tab">7</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="8" /><span class="sheet-rounded-tab">8</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="9" /><span class="sheet-rounded-tab">9</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="10" /><span class="sheet-rounded-tab">10</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="11" /><span class="sheet-rounded-tab">11</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="12" /><span class="sheet-rounded-tab">12</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="13" /><span class="sheet-rounded-tab">13</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="14" /><span class="sheet-rounded-tab">14</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="15" /><span class="sheet-rounded-tab">15</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="all" title="Tous les niveaux" /><span class="sheet-rounded-tab">X</span>

				<br />
				<br />

				<span class="sheet-hint">Bonus d'intelligence aux dégats : <input class="sheet-shortInput sheet-autoCalc" name="attr_bonusDegatsIntel" value="0" readonly="readonly" type="text"></span>
				<span class="sheet-hint">Bonus d'équipement aux dégats : <input class="sheet-shortInput" name="attr_bonusDegatsSorts" value="0" type="text"></span>

				<br />
				<br />

				<div class="sheet-section sheet-section-sp-list">
					<fieldset class="repeating_magies">
						<input type="checkbox" class="sheet-hidden sheet-magie-filtre" name="attr_Magie_Filtre" checked="checked" value="1" />

						<div class="sheet-magie-filtre">
							<div class="sheet-col" style="width: 200px;">
								<input type="text" class="sheet-noBorder" name="attr_Magie_Nom" value="" />
							</div>
							<div class="sheet-col" style="width: 70px; padding-top: 5px; text-align:right;">
								<b>Ecole </b>
							</div>
							<div class="sheet-col" style="width: 130px;">
								<input type="text" class="sheet-noBorder" name="attr_Magie_Ecole" value="" />
							</div>
							<div class="sheet-col" style="width: 130px;">
								<b>Niveau </b><select name="attr_Magie_Niveau">
									<option value="0">Multi</option>
									<option value="1">1</option>
									<option value="2">2</option>
									<option value="3">3</option>
									<option value="4">4</option>
									<option value="5">5</option>
									<option value="6">6</option>
									<option value="7">7</option>
									<option value="8">8</option>
									<option value="9">9</option>
									<option value="10">10</option>
									<option value="11">11</option>
									<option value="12">12</option>
									<option value="13">13</option>
									<option value="14">14</option>
									<option value="15">15</option>
								</select>
							</div>
							<div class="sheet-col" style="width: 100px;">
								<button type="roll" value="@{displayJet} &{template:magie} {{name=@{magie_nom}}} {{magie_ecole=@{magie_ecole}}} {{magie_niveau=@{magie_niveau}}} {{magie_display_epreuve=@{Magie_EpreuveLanceur_Jet}}}  {{magie_display_resistance=@{Magie_EpreuveCible_Jet}}} {{magie_incantation=@{magie_incantation}}} {{magie_duree=@{magie_duree}}} {{magie_cout=@{magie_cout}}} {{magie_portee=@{magie_portee}}} {{magie_effet=@{magie_effet}}} {{magie_ingre=@{magie_ingre}}} {{magie_aireeffet=@{magie_aireeffet}}} {{magie_soin=@{magie_soin}}} {{magie_degats=@{Magie_Degats}}} {{magie_bonusint=[[@{MagieBonusInt}]]}} {{magie_epreuve=@{Magie_EpreuveLanceur_Jet} + @{Magie_EpreuveLanceur_mod}}} {{magie_resistance=@{Magie_EpreuveCible_Jet} + @{Magie_EpreuveCible_mod}}} {{creature_ev=@{creature_ev}}} {{creature_int=@{creature_int}}} {{creature_at=@{creature_at}}} {{creature_def=@{creature_def}}} {{creature_cou=@{creature_cou}}} {{creature_pr=@{creature_pr}}} {{creature_xp=@{creature_xp}}} {{creature_resimagie=@{creature_resimagie}}} {{creature_degats=@{creature_degats}}} {{magie_epreuveappel_mod=@{magie_epreuveappel_mod}}} {{magie_epreuvecontrol_mod=@{magie_epreuvecontrol_mod}}} {{magie_epreuverevocation_mod=@{magie_epreuverevocation_mod}}}"> Grimmoire </button>
							</div>
							<br clear="all" />
							<br />
							<div>
								<input type="checkbox" class="sheet-display-magie sheet-display-magie-incantation"  name="attr_Magie_Display_Incantation" value="1" /> <span class="sheet-display-magie">Incantation</span>
								<input type="checkbox" class="sheet-display-magie sheet-display-magie-epreuve"  name="attr_Magie_Display_Epreuve" value="1" /> <span class="sheet-display-magie">Épreuves</span>
								<input type="checkbox" class="sheet-display-magie sheet-display-magie-soins"  name="attr_Magie_Display_Soins" value="1" /> <span class="sheet-display-magie">Soins</span>
								<input type="checkbox" class="sheet-display-magie sheet-display-magie-degats"  name="attr_Magie_Display_Degats" value="1" /> <span class="sheet-display-magie">Dégats</span>
								<input type="checkbox" class="sheet-display-magie sheet-display-magie-effet"  name="attr_Magie_Display_Effet" value="1" /> <span class="sheet-display-magie">Effets</span>
								<input type="checkbox" class="sheet-display-magie sheet-display-magie-ingre"  name="attr_Magie_Display_Ingre" value="1" /> <span class="sheet-display-magie">Ingré.</span>
								<input type="checkbox" class="sheet-display-magie sheet-display-magie-creature"  name="attr_Magie_Display_Creature" value="1" /> <span class="sheet-display-magie">Créature</span>
								<br clear="all" />
								<div class="sheet-display-magie-incantation">
									<br />
									<table width="100%">
										<thead>
											<tr>
												<th style="border-right:1px dotted white;">Durée d'incantation</th>
												<th>Durée du sort</th>
											</tr>
										</thead>
										<tr>
											<td style="text-align:center;"><input type="text" class="sheet-noBorder" name="attr_Magie_Incantation" value="" /></td>
											<td style="text-align:center"><input type="text" class="sheet-noBorder" name="attr_Magie_Duree" value="" /></td>
										</tr>
										<thead>
											<tr>
												<th style="border-right:1px dotted white;">Portée</th>
												<th>Aire d'éffet</th>
											</tr>
										</thead>
										<tr>
											<td style="text-align:center;"><input type="text" class="sheet-noBorder" name="attr_Magie_Portee" value="" />	</td>
											<td style="text-align:center"><input type="text" class="sheet-noBorder" name="attr_Magie_AireEffet" value="" /></td>
										</tr>
										<thead>
											<th style="border-right:1px dotted white;">Cout</th>
											<th>Notes</th>
										</thead>
										<tr>
											<td style="text-align:center;"><input type="text" class="sheet-noBorder" name="attr_Magie_Cout" value="" /></td>
											<td style="text-align:center"><input type="text" class="sheet-noBorder" name="attr_Magie_Notes" value="" /></td>
										</tr>
									</table>
								</div>
								<div class="sheet-display-magie-epreuve">
									<br />
									<table width="100%">
										<thead>
											<tr>
												<th style="width:50%; border-right:1px dotted white;" colspan="3">Épreuve Lanceur</th>
												<th style="width:50%" colspan="3">Confrontation cible</th>
											</tr>
											<tr>
												<th>Stat.</th>
												<th>Mod.</th>
												<th style="border-right:1px dotted white;"></th>
												<th>Stat.</th>
												<th>Mod.</th>
												<th></th>
											</tr>
										</thead>
										<tr>
											<td colspan="5"></td>
										</tr>
										<tr>
											<td style="text-align:center;">
												<select name="attr_Magie_EpreuveLanceur_Jet">
													<option value="" selected="selected"></option>
													<option value="Magie Phy. : @{Stats_MagiePhy_total}">Magie Phy.</option>
													<option value="Magie Psy. : @{Stats_MagiePsy_total}">Magie Psy.</option>
													<option value="INT : @{Stats_Intelligence_total}">INT</option>
													<option value="COU : @{Stats_Courage_total}">COU</option>
													<option value="CHA : @{Stats_Charisme_total}">CHA</option>
													<option value="AD : @{Stats_Adresse_total}">AD</option>
													<option value="FO : @{Stats_Force_total}">FO</option>
													<option value="AT : @{Stats_Attaque_total}">AT</option>
													<option value="PRD : @{Stats_Parade_total}">PRD</option>
												</select>
											</td>
											<td style="text-align:center;">
												<input type="text" class="sheet-shortInput" name="attr_Magie_EpreuveLanceur_mod" value="0" />
											</td>
											<td style="text-align:center; ">
												<button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} se concentre pour lancer @{Magie_Nom} }} {{ Épreuve=@{Magie_EpreuveLanceur_Jet} + [[@{Magie_EpreuveLanceur_mod}]] }} {{ Résultat = [[1d20]] }}"> Épreuve </button>
											</td>
											<td style="text-align:center;">
												<select name="attr_Magie_EpreuveCible_Jet">
													<option value="" selected="selected"></option>
													<option value="Resits. Magie">Résist. Magie</option>
													<option value="Magie Phy.">Magie Phys.</option>
													<option value="Magie Psy.">Magie Psy.</option>
													<option value="INT">INT</option>
													<option value="COU">COU</option>
													<option value="CHA">CHA</option>
													<option value="AD">AD</option>
													<option value="FO">FO</option>
												</select>
											</td>
											<td style="text-align:center;">
												<input type="text" class="sheet-shortInput" name="attr_Magie_EpreuveCible_mod" value="0" />
											</td>
											<td style="text-align:center;">
												<button type="roll" value="@{displayJet} &{template:default} {{name=Confrontation magique}} {{ @{Personnage_Nom}=@{Magie_EpreuveLanceur_Jet} + [[@{Magie_EpreuveLanceur_mod}]] }} {{ Cible = @{Magie_EpreuveCible_Jet} + @{Magie_EpreuveCible_mod} }}"> Confrontation </button>
											</td>
										</tr>
									</table>
								</div>
								<div class="sheet-display-magie-soins">
									<br />
									<table width="100%">
									<thead>
										<tr>
											<th>Montant des soins</th>
										</tr>
									</thead>
									<tr>
										<td style="text-align:center;">
											<input type="text" class="sheet-shortInput" name="attr_Magie_Soin" value="" placeholder="1d6" />
											<button type="roll" class="sheet-rollDegats" value="@{displayJet} &{template:default} {{name=@{Magie_Nom} de @{Personnage_Nom} soigne à hauteur de }} {{EV = [[@{Magie_Soin}]] }}"> Soigner </button>
										</td>
									</tr>
									</table>
								</div>
								<div class="sheet-display-magie-degats">
									<br />
									<table width="100%">
									<thead>
										<tr>
											<th style="width:15%">Bonus d'intel ?</th>
											<th>Montant des dégats</th>
										</tr>
									</thead>
									<tr>
										<td style="text-align:center;">
											<input type="checkbox" name="attr_MagieBonusInt" value="@{bonusDegatsIntel}" />
										</td>
										<td style="text-align:center;">
											<input type="text" class="sheet-shortInput" name="attr_Magie_Degats" value="" placeholder="1d6" />
											<button type="roll" class="sheet-rollDegats" value="@{displayJet} &{template:default} {{name=Dégats de @{Personnage_Nom} avec @{Magie_Nom}}} {{Dégats = [[@{Magie_Degats} + @{magieBonusInt} + @{bonusDegatsSorts}]]  }}"> Dégats </button>
										</td>
									</tr>
									</table>
								</div>
								<div class="sheet-display-magie-effet">
									<br />
									Effets :
									<textarea name="attr_Magie_Effet"></textarea>
								</div>
								<div class="sheet-display-magie-ingre">
									<br />
									Ingrédients :
									<textarea name="attr_Magie_Ingre"></textarea>
								</div>
								<div class="sheet-display-magie-creature">
									<br />
									<table width="100%">
										<tr>
											<th>Énergie vitale</th>
											<td><input type="number" class="sheet-shortInput" name="attr_Creature_EV" value="" /></td>
											<th>INT</th>
											<td><input type="number" class="sheet-shortInput" name="attr_Creature_INT" value="" /></td>
										</tr>
										<tr>
											<th>AT</th>
											<td><input type="number" class="sheet-shortInput" name="attr_Creature_AT" value="" /></td>
											<th>PRD / Esquive</th>
											<td><input type="number" class="sheet-shortInput" name="attr_Creature_DEF" value="" /></td>
										</tr>
										<tr>
											<th>COU</th>
											<td><input type="number" class="sheet-shortInput" name="attr_Creature_COU" value="" /></td>
											<th>PR</th>
											<td><input type="number" class="sheet-shortInput" name="attr_Creature_PR" value="" /></td>
										</tr>
										<tr>
											<th>Classe/XP</th>
											<td><input type="number" class="sheet-shortInput" name="attr_Creature_XP" value="" /></td>
											<th>Résist. Magie</th>
											<td><input type="number" class="sheet-shortInput" name="attr_Creature_ResiMagie" value="" /></td>
										</tr>
										<tr>
											<th>Dégâts</th>
											<td colspan="3">
												<input type="text" class="sheet-shortInput" name="attr_Creature_Degats" value="1d6" />
												<button type="roll" class="sheet-rollDegats" value="@{displayJet} &{template:default} {{name=Attaque de @{Magie_Nom}, invoqué par @{Personnage_Nom} }} {{ Dégats = [[@{Creature_Degats}]] }}"> Dégats </button>
											</td>
										</tr>
									</table>
									<br />
									<table width="100%">
										<thead>
											<tr>
												<th style="width:33%; border-right:1px dotted white;">Épreuve d'Appel</th>
												<th style="width:33%; border-right:1px dotted white;">Épreuve de Contrôle</th>
												<th style="width:33%">Épreuve de Révocation</th>
											</tr>
										</thead>
										<tr>
											<td colspan="3"></td>
										</tr>
										<tr>
											<td style="text-align:center; ">
												Magie Psy.
												<input type="number" name="attr_Magie_EpreuveAppel_mod" value="0" />
												<button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente d'appeler @{Magie_Nom} }} {{Épreuve=@{Stats_MagiePsy_total} + [[@{Magie_EpreuveAppel_mod}]] }} {{ Résultat = [[1d20]] }}"> Épreuve </button>
											</td>
											<td style="text-align:center; ">
												Magie Psy.
												<input type="text" class="sheet-shortInput" name="attr_Magie_EpreuveControl_mod" value="2D6" />
												<button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente de controler @{Magie_Nom} }} {{ @{Personnage_Nom}=@{Stats_MagiePsy_total} + [[@{Magie_EpreuveControl_mod}]] }} {{ Cible = Résist. Magie + 2D6 }} "> Confrontation </button>
												<br />
												<span class="sheet-hint">Cible : 2D6 + Résist. Magie</span>
											</td>
											<td style="text-align:center;">
												Magie Psy.
												<input type="text" class="sheet-shortInput" name="attr_Magie_EpreuveRevocation_mod" value="3D6" />
												<button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente de révoquer @{Magie_Nom} }} {{ @{Personnage_Nom}=@{Stats_MagiePsy_total} + [[@{Magie_EpreuveRevocation_mod}]] }} {{ Cible = Résist. Magie + 3D6 }} "> Confrontation </button>
												<br />
												<span class="sheet-hint">Cible : 3D6 + Résist. Magie</span>
											</td>
										</tr>
									</table>
								</div>
							</div>
						</div>
					</fieldset>
				</div>
				<br clear="all" />
			</div>
		</div>

		<!-- TAB Inventaire -->
		<div class="sheet-tab_inventaire">
			<div class="sheet-col-float">
				<h2>Mes richesses</h2>
				<table>
					<tr>
						<th>Pièces d'Or</th>
						<td><input type="number" name="attr_Richesse_Or" value="0" /></td>
					</tr>
					<tr>
						<th>Pièces d'Argent</th>
						<td><input type="number" name="attr_Richesse_Argent" value="0" /></td>
					</tr>
					<tr>
						<th>Pièces de Cuivre</th>
						<td><input type="number" name="attr_Richesse_Cuivre" value="0" /></td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<th>Lingots de Berylium</th>
						<td><input type="number" name="attr_Richesse_Berylium" value="0" /></td>
					</tr>
					<tr>
						<th>Lingots de Thritil</th>
						<td><input type="number" name="attr_Richesse_Thritil" value="0" /></td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<th>Billets 10</th>
						<td><input type="number" name="attr_Richesse_Billet10" value="0" /></td>
					</tr>
					<tr>
						<th>Billets 50</th>
						<td><input type="number" name="attr_Richesse_Billet50" value="0" /></td>
					</tr>
					<tr>
						<th>Billets 100</th>
						<td><input type="number" name="attr_Richesse_Billet100" value="0" /></td>
					</tr>
					<tr>
						<th>Billets 500</th>
						<td><input type="number" name="attr_Richesse_Billet500" value="0" /></td>
					</tr>
					<tr>
						<th>Billets 1000</th>
						<td><input type="number" name="attr_Richesse_Billet1000" value="0" /></td>
					</tr>
				</table>
			</div>
			<div class="sheet-col-float">
				<h2>Bivouac & Camping</h2>
				<table>
					<thead>

						<tr>
							<td></td>
							<th style="width:140px;">Récup.</th>

						</tr>
					</thead>
					<tr>
						<td><input type="text" class="sheet-noBorder" name="attr_bivouac_Couverture" value="" placeholder="Couverture" /></td>
						<td><input type="text" class="sheet-noBorder" name="attr_bivouac_Couverture_Recup" value="" placeholder="1EV / 2H - 3EA / 1H" /></td>

					</tr>
					<tr>
						<td><input type="text" class="sheet-noBorder" name="attr_bivouac_Matelas" value="" placeholder="Matelas" /></td>
						<td><input type="text" class="sheet-noBorder" name="attr_bivouac_Matelas_Recup" value="" /></td>

					</tr>
					<tr>
						<td><input type="text" class="sheet-noBorder" name="attr_bivouac_Tente" value="" placeholder="Tente" /></td>
						<td><input type="text" class="sheet-noBorder" name="attr_bivouac_Tente_Recup" value="" /></td>

					</tr>
					<tr>

						<td colspan="2"><span class="sheet-hint">Récup. : <span title="+1 EV pour 4H de repos&#10;+2 EA pour 1H de repos" style="border-bottom:1px dotted black;">Basse</span>, <span title="+1 EV pour 2H de repos&#10;+3 EA pour 1H de repos" style="border-bottom:1px dotted black;">Normale</span>, <span title="+1 EV pour 1H de repos&#10;+4 EA pour 1H de repos" style="border-bottom:1px dotted black;">Excellente</span></span></td>

					</tr>
				</table>
			</div>

			<div class="sheet-col-float">
				<h2>Encombrement</h2>
				<table>
					<tr>
						<th title="Selon Origine du personnage">Charge max</th>
						<td><input type="text" class="sheet-shortInput" name="attr_Personnage_Charge_max" value="0" /> </td>
						<td colspan="2">Kg</td>
					</tr>
					<tr>
						<th>Bourses</th>
						<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_poids_Bourses" value="0" readonly="readonly" /></td>
						<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_poids_Bourses_max" value="0" readonly="readonly" /></td>
						<td>Pièces</td>
					</tr>
					<tr>
						<th>Sacs</th>
						<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_poids_Sacs" value="0" readonly="readonly" /></td>
						<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_poids_Sacs_max" value="0" readonly="readonly" /> </td>
						<td>Kg</td>
					</tr>
					<tr>
						<td colspan="4">
							<input type="radio" value="0" name="attr_Personnage_Surcharge" class="sheet-hidden sheet-overweight-checkbox sheet-overweight-0" checked>
							<input type="radio" value="1" name="attr_Personnage_Surcharge" class="sheet-hidden sheet-overweight-checkbox sheet-overweight-1">
							<input type="radio" value="2" name="attr_Personnage_Surcharge" class="sheet-hidden sheet-overweight-checkbox sheet-overweight-2">
							<input type="radio" value="3" name="attr_Personnage_Surcharge" class="sheet-hidden sheet-overweight-checkbox sheet-overweight-3">
							<input type="radio" value="4" name="attr_Personnage_Surcharge" class="sheet-hidden sheet-overweight-checkbox sheet-overweight-4">
							<input type="radio" value="5" name="attr_Personnage_Surcharge" class="sheet-hidden sheet-overweight-checkbox sheet-overweight-5">
							<div class="sheet-overweight">
							</div>
						</td>
					</tr>
				</table>
			</div>

			<div class="sheet-col-float">
				<br />
				<h2>Sacs & Bourses</h2>
				<div class="sheet-col-float">
					<div class="sheet-tableth">
						<div class="sheet-col" style="width: 190px;">Sacs</div>
						<div class="sheet-col" style="width: 66px;">Poids max</div>
					</div>
					<fieldset class="repeating_sacs">
						<div class="sheet-row">
							<div class="sheet-col" style="width: 190px;">
								<input type="text" class="sheet-noBorder" name="attr_Sac_Nom" value="" />
							</div>
							<div class="sheet-col" style="width: 70px;">
								<input type="number" name="attr_Sac_Charge_max" value="0" />
							</div>
						</div>
					</fieldset>
				</div>
				<div class="sheet-col-float">
					<div class="sheet-tableth">
						<div class="sheet-col" style="width: 180px;">Bourses</div>
						<div class="sheet-col" style="width: 80px;">Pièces max</div>
					</div>
					<fieldset class="repeating_bourses">
						<div class="sheet-row">
							<div class="sheet-col" style="width: 190px;">
								<input type="text" class="sheet-noBorder" name="attr_Bourse_Nom" value="" />
							</div>
							<div class="sheet-col" style="width: 70px;">
								<input type="number" name="attr_Bourse_Charge_max" value="0" />
							</div>
						</div>
					</fieldset>
				</div>
			</div>

			<br clear="all" />
			<br />

			<input type="radio" class="sheet-tab sheet-tab_materiel" name="attr_tab_inventaire" value="Matériel" checked="checked" /><span class="sheet-tab">Matériel</span>
			<input type="radio" class="sheet-tab sheet-tab_butin" name="attr_tab_inventaire" value="Butins" /><span class="sheet-tab">Butins</span>
			<input type="radio" class="sheet-tab sheet-tab_divers" name="attr_tab_inventaire" value="Divers" title="Bouffe, Boissons, Gemmes, Objets de quête, Livres" /><span class="sheet-tab">Divers</span>
			<input type="radio" class="sheet-tab sheet-tab_conso" name="attr_tab_inventaire" value="Potions" title="Potions / Poisons / Antidotes" /><span class="sheet-tab">Potions</span>
			<input type="radio" class="sheet-tab sheet-tab_ingre" name="attr_tab_inventaire" value="Ingrédients" /><span class="sheet-tab">Ingrédients</span>
			<input type="radio" class="sheet-tab sheet-tab_reliques" name="attr_tab_inventaire" value="Spéciaux" title="Objets spéciaux, Maudits, Reliques" /><span class="sheet-tab">Objets spéciaux</span>
			<input type="radio" class="sheet-tab sheet-tab_tout" name="attr_tab_inventaire" value="Tout" title="Tout afficher" /><span class="sheet-tab">Tout afficher</span>

			<br clear="all" />
			<br />

			<div class="sheet-tab_materiel">
				<div class="sheet-tableth">
					<div class="sheet-col" style="width: 315px;">Matériel</div>
					<div class="sheet-col" style="width: 70px;">Poids</div>
					<div class="sheet-col" style="width: 315px;"></div>
					<div class="sheet-col" style="width: 70px;">Poids</div>
				</div>
				<fieldset class="repeating_materiels">
					<div class="sheet-row">
						<div class="sheet-col" style="width: 320px;">
							<input type="text" class="sheet-noBorder" name="attr_Materiel_Nom" value="" />
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="number" name="attr_Materiel_Poids" value="0" step="0.1" />
						</div>
					</div>
				</fieldset>

				<br clear="all" />
				<br />
			</div>

			<div class="sheet-tab_butin">
				<div class="sheet-tableth">
					<div class="sheet-col" style="width: 315px;">Butins</div>
					<div class="sheet-col" style="width: 70px;">Poids</div>
					<div class="sheet-col" style="width: 315px;"></div>
					<div class="sheet-col" style="width: 70px;">Poids</div>
				</div>
				<fieldset class="repeating_butins">
					<div class="sheet-row">
						<div class="sheet-col" style="width: 320px;">
							<input type="text" class="sheet-noBorder" name="attr_Butin_Nom" value="" />
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="number" name="attr_Butin_Poids" value="0" step="0.1" />
						</div>
					</div>
				</fieldset>

				<br clear="all" />
				<br />
			</div>

			<div class="sheet-tab_divers">
				<div class="sheet-col-float">
					<div class="sheet-tableth">
						<div class="sheet-col" style="width: 315px;">Bouffe & Boisson</div>
						<div class="sheet-col" style="width: 70px;">Poids</div>
					</div>
					<fieldset class="repeating_bouffes">
						<div class="sheet-row">
							<div class="sheet-col" style="width: 320px;">
								<input type="text" class="sheet-noBorder" name="attr_Bouffe_Nom" value="" />
							</div>
							<div class="sheet-col" style="width: 70px;">
								<input type="number" name="attr_Bouffe_Poids" value="0" step="0.1" />
							</div>
						</div>
					</fieldset>
				</div>

				<div class="sheet-col-float">
					<div class="sheet-tableth">
						<div class="sheet-col" style="width: 315px;">Gemmes</div>
						<div class="sheet-col" style="width: 70px;">U.G</div>
					</div>
					<fieldset class="repeating_gemmes">
						<div class="sheet-row">
							<div class="sheet-col" style="width: 320px;">
								<input type="text" class="sheet-noBorder" name="attr_Gemme_Nom" value="" />
							</div>
							<div class="sheet-col" style="width: 70px;">
								<input type="number" name="attr_Gemme_UG" value="" />
							</div>
						</div>
					</fieldset>
				</div>

				<br clear="all">
				<br />

				<div class="sheet-col-float">
					<div class="sheet-tableth">
						<div class="sheet-col" style="width: 393px;">Objets de Quête</div>
					</div>
					<fieldset class="repeating_quetes">
						<div class="sheet-row">
							<div class="sheet-col" style="width: 393px;">
								<input type="text" class="sheet-noBorder" name="attr_Quete_Nom" value="" />
							</div>
						</div>
					</fieldset>
				</div>

				<div class="sheet-col-float">
					<div class="sheet-tableth">
						<div class="sheet-col" style="width: 393px;">Livres (500 gr)</div>
					</div>
					<fieldset class="repeating_livres">
						<div class="sheet-row">
							<div class="sheet-col" style="width: 393px;">
								<input type="text" class="sheet-noBorder" name="attr_Livre_Nom" value="" />
							</div>
						</div>
					</fieldset>
				</div>

				<br clear="all" />
				<br />
			</div>

			<div class="sheet-tab_conso">
				<div class="sheet-tableth">
					<div class="sheet-col" style="width: 366px;">Potions</div>
					<div class="sheet-col" style="width: 70px;">Doses</div>
					<div class="sheet-col" style="width: 366px;">Effets</div>
				</div>
				<fieldset class="repeating_potions">
					<div class="sheet-row">
						<div class="sheet-col" style="width: 370px;">
							<input type="text" class="sheet-noBorder" name="attr_Conso_Nom" value="" />
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="number" name="attr_Conso_Count" value="0" />
						</div>
						<div class="sheet-col" style="width: 370px;">
							<input type="text" class="sheet-noBorder" name="attr_Conso_Effet" value="" />
						</div>
					</div>
				</fieldset>

				<br clear="all"	/>
				<br />

				<div class="sheet-tableth">
					<div class="sheet-col" style="width: 366px;">Poisons</div>
					<div class="sheet-col" style="width: 70px;">Doses</div>
					<div class="sheet-col" style="width: 366px;">Effets</div>
				</div>
				<fieldset class="repeating_poisons">
					<div class="sheet-row">
						<div class="sheet-col" style="width: 370px;">
							<input type="text" class="sheet-noBorder" name="attr_Conso_Nom" value="" />
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="number" name="attr_Conso_Count" value="0" />
						</div>
						<div class="sheet-col" style="width: 370px;">
							<input type="text" class="sheet-noBorder" name="attr_Conso_Effet" value="" />
						</div>
					</div>
				</fieldset>

				<br clear="all"	/>
				<br />

				<div class="sheet-tableth">
					<div class="sheet-col" style="width: 366px;">Antidotes</div>
					<div class="sheet-col" style="width: 70px;">Doses</div>
					<div class="sheet-col" style="width: 366px;">Effets</div>
				</div>
				<fieldset class="repeating_antidotes">
					<div class="sheet-row">
						<div class="sheet-col" style="width: 370px;">
							<input type="text" class="sheet-noBorder" name="attr_Conso_Nom" value="" />
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="number" name="attr_Conso_Count" value="0" />
						</div>
						<div class="sheet-col" style="width: 370px;">
							<input type="text" class="sheet-noBorder" name="attr_Conso_Effet" value="" />
						</div>
					</div>
				</fieldset>

				<br clear="all" />
				<br />
			</div>

			<div class="sheet-tab_ingre">
				<div class="sheet-tableth">
					<div class="sheet-col" style="width: 315px;">Ingrédients</div>
					<div class="sheet-col" style="width: 70px;">NB</div>
					<div class="sheet-col" style="width: 315px;"></div>
					<div class="sheet-col" style="width: 70px;">NB</div>
				</div>
				<fieldset class="repeating_ingre">
					<div class="sheet-row">
						<div class="sheet-col" style="width: 320px;">
							<input type="text" class="sheet-noBorder" name="attr_Ingre_Nom" value="" />
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="number" name="attr_Ingre_Count" value="0" />
						</div>
					</div>
				</fieldset>

				<br clear="all" />
				<br />
			</div>

			<div class="sheet-tab_reliques">
				<div class="sheet-tableth">
					<div class="sheet-col" style="width: 350px;">Objets spéciaux, Maudits, Reliques</div>
					<div class="sheet-col" style="width: 460px;">Effets</div>
				</div>
				<fieldset class="repeating_reliques">
					<div class="sheet-row">
						<div class="sheet-col" style="width: 350px;">
							<input type="text" class="sheet-noBorder" name="attr_Relique_Nom" value="" />
						</div>
						<div class="sheet-col" style="width: 460px;">
							<input type="text" class="sheet-noBorder" name="attr_Relique_Effet" value="" />
						</div>
					</div>
				</fieldset>
			</div>

			<br clear="all" />
			<br />
		</div>

		<!-- TAB Compagnons -->
		<div class="sheet-tab_compagnons">
			<fieldset class="repeating_compagnons">
				<div class="sheet-col-float" style="width:10%">Nom :</div>
				<div class="sheet-col-float" style="width:30%"><input type="text" name="attr_Compagnon_Nom" class="sheet-noBorder"></div>
				<div class="sheet-col-float" style="width:10%">Type :</div>
				<div class="sheet-col-float" style="width:30%"><input type="text" name="attr_Compagnon_Type" class="sheet-noBorder"></div>
				<input type="checkbox" class="sheet-display-monture" name="attr_Compagnon_display" value="1" checked="checked" /> <span class="sheet-display-monture">Afficher</span>
				<br clear="all" />
				<div class="sheet-display-monture">
					<div class="sheet-col-float" style="width:300px;">
						<div class="sheet-monture_stats">
							<h2>Caractéristiques</h2>
							<table width="100%">
								<tr>
									<th colspan="2">Énergie vitale</th>
									<td><input type="number" class="sheet-shortInput" name="attr_Compagnon_EV" value="" /></td>
									<td><input type="number" class="sheet-shortInput" name="attr_Compagnon_EV_max" value="" /></td>
								</tr>
								<tr>
									<th>COU</th>
									<td><input type="number" class="sheet-shortInput" name="attr_Compagnon_Cou" value="" /></td>
									<th style="text-align:center;">AT</th>
									<td><input type="number" class="sheet-shortInput" name="attr_Compagnon_AT" value="" /></td>
								</tr>
								<tr>
									<th>Esquive</th>
									<td><input type="number" class="sheet-shortInput" name="attr_Compagnon_Esquive" value="" /></td>
									<th style="text-align:center;">PRD</th>
									<td><input type="number" class="sheet-shortInput" name="attr_Compagnon_PRD" value="" /></td>
								</tr>
								<tr>
									<th>Charge</th>
									<td><input type="number" class="sheet-shortInput" name="attr_Compagnon_Charge" value="" /></td>
									<th style="text-align:center;">Charge Max</th>
									<td><input type="number" class="sheet-shortInput" name="attr_Compagnon_Charge_max" value="" /></td>
								</tr>
								<tr>
									<th>PR</th>
									<td><input type="number" class="sheet-shortInput" name="attr_Compagnon_PR" value="" /></td>
									<th style="text-align:center;">Résist. Magie</th>
									<td><input type="number" class="sheet-shortInput" name="attr_Compagnon_ResiMagie" value="" /></td>
								</tr>
							</table>
						</div>
						<div class="sheet-monture_deplacement">
							<br>
							<h2>Déplacement</h2>
							<table width="100%">
								<thead>
									<tr>
										<td></td>
										<th>Sol</th>
										<th>Air</th>
										<td></td>
									</tr>
								</thead>
								<tr>
									<th>Assault</th>
									<td><input type="number" class="sheet-shortInput" name="attr_Compagnon_Deplacement_Assaut_sol" value="0" /></td>
									<td><input type="number" class="sheet-shortInput" name="attr_Compagnon_Deplacement_Assaut_air" value="0" /></td>
									<td><span class="sheet-hint">M</span></td>
								</tr>
								<tr>
									<th>Charge</th>
									<td><input type="number" class="sheet-shortInput" name="attr_Compagnon_Deplacement_Charge_sol" value="0" /></td>
									<td><input type="number" class="sheet-shortInput" name="attr_Compagnon_Deplacement_Charge_air" value="0" /></td>
									<td><span class="sheet-hint">M</span></td>
								</tr>
								<tr>
									<th>Voyage</th>
									<td><input type="number" class="sheet-shortInput" name="attr_Compagnon_Deplacement_Voyage_sol" value="0" /></td>
									<td><input type="number" class="sheet-shortInput" name="attr_Compagnon_Deplacement_Voyage_air" value="0" /></td>
									<td><span class="sheet-hint">KM/H</span></td>
								</tr>
								<tr>
									<th>Voyage</th>
									<td><input type="number" class="sheet-shortInput" name="attr_Compagnon_Deplacement_Jour_sol" value="0" /></td>
									<td><input type="number" class="sheet-shortInput" name="attr_Compagnon_Deplacement_Jour_air" value="0" /></td>
									<td><span class="sheet-hint">KM/J</span></td>
								</tr>
							</table>
						</div>
					</div>
					<div class="sheet-col-float" style="width:500px;">
						<div class="sheet-monture_combat">
							<h2>Combat</h2>
							<textarea name="attr_Compagnon_Combat"></textarea>
						</div>
						<div class="sheet-monture_entretien">
							<h2>Entretien</h2>
							<textarea name="attr_Compagnon_Entretien"></textarea>
						</div>
						<div class="sheet-monture_autres">
							<h2>Autres</h2>
							<textarea name="attr_Compagnon_Autres"></textarea>
						</div>
					</div>
					<br clear="all">
					<br>
					<div class="sheet-monture_materiel">
						<h2>Matériel</h2>
						<div class="sheet-col-float" style="width:32%;">
							<input type="text" class="sheet-noBorder" name="attr_Compagnon_Materiel1_Nom" value="Sac N°1">
							<textarea name="attr_Compagnon_Materiel1"></textarea>
						</div>
						<div class="sheet-col-float" style="width:32%;">
							<input type="text" class="sheet-noBorder" name="attr_Compagnon_Materiel2_Nom" value="Sac N°2">
							<textarea name="attr_Compagnon_Materiel2"></textarea>
						</div>
						<div class="sheet-col-float" style="width:32%;">
							<input type="text" class="sheet-noBorder" name="attr_Compagnon_Materiel3_Nom" value="Sac N°3">
							<textarea name="attr_Compagnon_Materiel3"></textarea>
						</div>
					</div>
				</div>
			</fieldset>
		</div>
	</div>
	<!-- TAB Reglages -->
	<div class="sheet-body sheet-reglages">
		<h2>Réglages (v2.2)</h2>
		<p>
			<input type="checkbox" name="attr_displayJet" value="/w gm"> Envoyer les jets au MJ uniquement
			<br />
			<span class="sheet-hint">Cochez cette option pour que tous les jets soient cachés aux autres joueurs.</span>
		</p>
		<br />
		<div class="sheet-col-float" style="width:45%;">
			<h2>Sauvegarder</h2>
			<textarea name="attr_json_export"></textarea>
			<span class="sheet-hint">Sauvegarder son personnage Roll20 pour l'importer dans une autre partie</span>
			<div style="text-align:center">
				<input type="checkbox" class="sheet-tab" name="attr_export_start" value="1"><span class="sheet-tab">Démarrer</span>
			</div>
		</div>
		<div class="sheet-col-float" style="width:45%; float:right">
			<h2>Importer</h2>
			<textarea name="attr_json_import"></textarea>
			<span class="sheet-hint"><span style="color:#F00;">Attention</span>, toutes les données de la fiche seront écrasées</span>
			<div style="text-align:center">
				<input type="checkbox" class="sheet-tab" name="attr_import_start" value="1"><span class="sheet-tab">Démarrer</span>
			</div>
		</div>
	</div>

	<div class="sheet-body sheet-pnj">
		<h2>Caractéristiques</h2>
		<table style="width:100%">
			<thead>
				<tr>
					<th><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente une épreuve de Courage }} {{ Courage=@{Stats_Courage} }} {{ Résultat=[[1d20]] }}"> COU</button></th>
					<th><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente une épreuve d'Intelligence }} {{ Intelligence=@{Stats_Intelligence} }} {{ Résultat=[[1d20]] }}"> INT</button></th>
					<th><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente une épreuve de Charisme}} {{ Charisme=@{Stats_Charisme} }} {{ Résultat=[[1d20]] }}"> CHA</button></th>
					<th><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente une épreuve d'Adresse}} {{ Adresse=@{Stats_Adresse} }} {{ Résultat=[[1d20]] }}"> AD</button></th>
					<th><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente une épreuve de Force}} {{ Force=@{Stats_Force} }} {{ Résultat=[[1d20]] }}"> FO</button></th>
					<th><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente une Attaque }} {{ Attaque=@{Stats_Attaque} }} {{ Résultat=[[1d20]] }}"> AT</button></th>
					<th><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente une Parade }} {{ Parade=@{Stats_Parade} }} {{ Résultat=[[1d20]] }}"> PRD</button></th>
					<th><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente une Attaque à distance }} {{ Jet=@{Stats_Jet} }} {{ Résultat=[[1d20]] }}"> JET</button></th>
					<th><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente une Esquive }} {{ Esquive=@{Stats_Esquive} }} {{ Résultat=[[1d20]] }}"> ESQ</button></th>
					<th><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} concentre sa Magie}} {{ Magie Phys=@{Stats_MagiePhy} }} {{ Résultat=[[1d20]] }} "> MPhy</button></th>
					<th><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} concentre sa Magie}} {{ Magie Psy=@{Stats_MagiePsy} }} {{ Résultat=[[1d20]] }}"> MPsy</button></th>
					<th><button type="roll" value="@{displayJet} &{template:default} {{name=@{Personnage_Nom} tente de résiter à la Magie}} {{ Résist. Magie=@{Stats_ResiMagie} }} {{ Résultat=[[1d20]] }} "> RM</button></th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><input type="number" name="attr_Stats_Courage" value="0"></td>
					<td><input type="number" name="attr_Stats_Intelligence" value="0"></td>
					<td><input type="number" name="attr_Stats_Charisme" value="0"></td>
					<td><input type="number" name="attr_Stats_Adresse" value="0"></td>
					<td><input type="number" name="attr_Stats_Force" value="0"></td>
					<td><input type="number" name="attr_Stats_Attaque" value="8"></td>
					<td><input type="number" name="attr_Stats_Parade" value="10"></td>
					<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_Stats_Jet" value="0" readonly="readonly"></td>
					<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_Stats_Esquive" value="0" readonly="readonly"></td>
					<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_Stats_MagiePhy" value="0" readonly="readonly"></td>
					<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_Stats_MagiePsy" value="0" readonly="readonly"></td>
					<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_Stats_ResiMagie" value="0" readonly="readonly"></td>
				</tr>
			</tbody>
		</table>
		<br />
		<div class="sheet-col-float">
			<table>
				<thead>
					<tr>
						<th colspan="3">Energie Vitale (EV) :</th>
					</tr>
				</thead>
				<tr>
					<td><input type="number" name="attr_EV" value="0" step="1"></td>
					<td>/</td>
					<td><input type="number" name="attr_EV_max" value="0" min="1" step="1"></td>
				</tr>
			</table>
		</div>
		<div class="sheet-col-float">
			<table>
				<thead>
					<tr>
						<th colspan="3">Energie Astrale (EA)</th>
					</tr>
				</thead>
				</tr>
					<td><input type="number" name="attr_EA" value="0" step="1"></td>
					<td>/</td>
					<td><input type="number" name="attr_EA_max" value="0" min="0" step="1"></td>
				</tr>
			</table>
		</div>
		<div class="sheet-col-float">
			<table>
				<thead>
					<tr>
						<th>Niveau</th>
					</tr>
				</thead>
				</tr>
					<td><input type="number" name="attr_Personnage_Niveau" value="0" step="1"></td>
				</tr>
			</table>
		</div>
		<div class="sheet-col-float">
			<table>
				<thead>
					<tr>
						<th>XP</th>
					</tr>
				</thead>
				</tr>
					<td><input type="number" name="attr_Personnage_XP" value="0" step="1"></td>
				</tr>
			</table>
		</div>
		<div class="sheet-col-float" style="text-align:center; width:150px;">
			<input type="checkbox" name="attr_modal_PNJ" class="sheet-modal" value="1" /><span class="sheet-cog">?</span> <span class="sheet-hint"> Macros utiles</span>
			<div class="sheet-modal-wrapper">
				<div class="sheet-modal" style="height:300px;">
					<div class="sheet-modal_header">
						<h2>Macros globales pour PNJ <span class="sheet-close">*</span><input type="checkbox" class="sheet-modal" name="attr_modal_PNJ" value="1" /></h2>
					</div>
					<div class="sheet-modal_body">
						Il est possible d'ajouter ces macros en tant que "Token action" (Action de Pion) pour fluidifier les combats.<br /><br />
						<b>Rajouter le PNJ dans le Turn Order :</b><br />
						<textarea class="sheet-code" rows="1">[[@{selected|Stats_Courage} &{tracker}]]</textarea>
						<b>Faire attaquer le PNJ avec son Arme N°1 :</b><br />
						<textarea class="sheet-code" rows="1">@{selected|displayJet} &{template:default} {{name=Attaque de @{selected|Personnage_Nom} avec @{selected|repeating_PNJarmes_$0_Arme_Nom} }} {{ Cible = @{target|Personnage_Nom} }} {{ AT=@{selected|repeating_PNJarmes_$0_Arme_Jet} + @{selected|repeating_PNJarmes_$0_Arme_At} }} {{ Résultat=[[1d20]] }}</textarea>
						<b>Faire parer le PNJ avec son Arme N°1 :</b><br />
						<textarea class="sheet-code" rows="1">@{selected|displayJet} &{template:default} {{name=Parade de @{selected|Personnage_Nom} avec @{selected|repeating_PNJarmes_$0_Arme_Nom} }} {{ PRD=@{selected|Stats_Parade_total} + @{selected|repeating_PNJarmes_$0_Arme_PRD} }} {{ Résultat=[[1d20]] }}</textarea>
						<b>Dégats de l'Arme N°1 :</b><br />
						<textarea class="sheet-code" rows="1">@{selected|displayJet} &{template:default} {{name=Dégats de @{selected|Personnage_Nom} avec @{selected|repeating_PNJarmes_$0_Arme_Nom}}} {{ Cible = @{target|Personnage_Nom} }} {{ Dégats=[[@{selected|repeating_PNJarmes_$0_Arme_Degats} + @{selected|BonusDegatsForce}]] }}</textarea>
						<span class="sheet-hint">Pour utiliser l'armre N°2, remplacer $0 par $1 et ainsi de suite.</span>
					</div>
				</div>
			</div>
		</div>
		<br clear="all" />
		<br />
		<div class="sheet-armes">
			<h2>Armement & Baston</h2>
			<div class="sheet-tableth">
				<div class="sheet-col" style="width: 246px;">Arme</div>
				<div class="sheet-col" style="width: 66px;">Portée</div>
				<div class="sheet-col" style="width: 66px;">AT</div>
				<div class="sheet-col" style="width: 66px;">PRD</div>
				<div class="sheet-col" style="width: 66px;">Dégats</div>
				<div class="sheet-col" style="width: 66px;">RUP.</div>
				<div class="sheet-col" style="width: 166px;">Jets</div>
			</div>

			<fieldset class="repeating_PNJarmes">
				<div class="sheet-row">
					<div class="sheet-col" style="width: 250px;">
						<input type="text" class="sheet-noBorder" name="attr_Arme_Nom" value="" />
					</div>
					<div class="sheet-col" style="width: 70px;">
						<select name="attr_Arme_Jet">
							<option value="@{Stats_Attaque_total}" selected="selected">Mélée</option>
							<option value="@{Stats_Jet_total}">Dist.</option>
						</select>
					</div>
					<div class="sheet-col" style="width: 70px;">
						<input type="number" name="attr_Arme_AT" value="0" />
					</div>
					<div class="sheet-col" style="width: 70px;">
						<input type="number" name="attr_Arme_PRD" value="0" />
					</div>
					<div class="sheet-col" style="width: 70px;">
						<input type="text" class="sheet-shortInput" name="attr_Arme_Degats" value="1d6" />
					</div>
					<div class="sheet-col" style="width: 70px;">
						<input type="text" class="sheet-shortInput" name="attr_Arme_RUP" value="" />
					</div>
					<div class="sheet-col" style="width: 180px;">
						<button type="roll" value="@{displayJet} &{template:default} {{name=Attaque de @{Personnage_Nom} avec @{Arme_Nom} }} {{ AT=@{Arme_Jet} + @{Arme_At} }} {{ Résultat=[[1d20]] }}"> AT </button>
						<button type="roll" value="@{displayJet} &{template:default} {{name=Parade de @{Personnage_Nom} avec @{Arme_Nom} }} {{ PRD=@{Stats_Parade_total} + @{Arme_PRD} }} {{ Résultat=[[1d20]] }}"> PRD </button>
						<button type="roll" class="sheet-rollDegats" value="@{displayJet} &{template:default} {{name=Dégats de @{Personnage_Nom} avec @{Arme_Nom}}} {{ Dégats=[[@{Arme_Degats} + @{BonusDegatsForce}]] }}"> Dégats </button>
					</div>
				</div>
			</fieldset>
		</div>
		<br clear="all" />
		<br />
		<div class="sheet-armure">
			<h2>Armures & Protections</h2>
			<div class="sheet-col-float" style="width:48%;">
				<table style="width:100%">
					<thead>
						<tr>
							<th style="text-align:center;">Tête</th>
							<th style="text-align:center;">Bras</th>
							<th style="text-align:center;">Mains</th>
							<th style="text-align:center;">Torse</th>
							<th style="text-align:center;">Jambes</th>
							<th style="text-align:center;">Pieds</th>
							<th style="text-align:center;">Bouclier</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td style="text-align:center;"><input type="number" name="attr_PR_Tete" value="0" /></td>
							<td style="text-align:center;"><input type="number" name="attr_PR_Bras" value="0" /></td>
							<td style="text-align:center;"><input type="number" name="attr_PR_Mains" value="0" /></td>
							<td style="text-align:center;"><input type="number" name="attr_PR_Torse" value="0" /></td>
							<td style="text-align:center;"><input type="number" name="attr_PR_Jambes" value="0" /></td>
							<td style="text-align:center;"><input type="number" name="attr_PR_Pieds" value="0" /></td>
							<td style="text-align:center;"><input type="number" name="attr_PR_Bouclier" value="0" /></td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="sheet-col-float" style="width:48%;">
				<table style="width:100%; text-align:center;">
					<thead>
						<th>PR Naturelle</th>
						<th>PR Physique</th>
						<th>PR Magique</th>
						<th>PR Totale</th>
					</thead>
					<tr>
						<td style="text-align:center;"><input type="number" name="attr_PRNat" value="0" /></td>
						<td style="text-align:center;"><input type="number" name="attr_PRPhy" value="0" /></td>
						<td style="text-align:center;"><input type="number" name="attr_PRMag" value="0" /></td>
						<td style="text-align:center;"><input type="number" name="attr_PR" value="0" /></td>
					</tr>
				</table>
			</div>
		</div>
		<br clear="all" />
		<br />
		<div class="sheet-butins">
			<h2>Butins</h2>
			<textarea name="attr_Personnage_Butins"></textarea>
		</div>
	</div>
</div>